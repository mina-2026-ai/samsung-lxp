<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="../common-style.css">
    <link rel="stylesheet" href="../sidebar-style.css">
    <link rel="stylesheet" href="../btn-style.css">
    <script src="../sidebar-function.js" defer></script>
    <script src="../common-funtion.js" defer></script>
    <title>Samsung Academy LXP - 과정 상세</title>
    <style>
        /* 폼 섹션 */
        td select, td input[type="text"] {
            width: 100%;
        }
        /* 모달 input 스타일 (삭제됨 - 사용되지 않음) */
        .form-wrap {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
            border-right: 1px solid var(--color-line-gray);
        }

        /* 과목 관리 영역 */
        .subject-wrap {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
        }

        /* subject/content related rules removed — not present in static HTML */

        .form-section {
            background: white;
            margin-bottom: 20px;
            border-bottom: 1px solid var(--color-line-gray);;
            border: 1px solid var(--color-line-gray);
            padding: 20px 24px 30px 24px;
            border-radius: 8px;
            display: flex;
            flex-direction: column;
            gap: 24px;
        }

        .section-title {
            font-size: 18px;
            font-weight: 700;
            color: #333;
            margin-bottom: 4px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        /* 폼 그룹 */
        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }

        .form-row-triple {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 20px;
        }

        .form-label {
            display: block;
            font-size: 14px;
            font-weight: 600;
            color: #333;
            margin-bottom: 4px;
        }

        .form-label.required::after {
            content: "*";
            color: #dc3545;
            margin-left: 4px;
        }

        /* form-textarea/input disabled styles removed (not used in static HTML) */

        /* 라디오/체크박스 그룹 */
        /* radio/checkbox group styles removed (not used in static HTML) */

        /* 입력 도움말 */
        .form-help {
            font-size: 12px;
            color: #999;
            margin-top: 6px;
        }

        /* 입력 단위 표시 */
        /* input-with-unit / date-range removed (not used in static HTML) */

        /* 메타 정보 (읽기 전용) */
        .meta-info-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 16px;
            background: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
        }

        .meta-item {
            display: flex;
            flex-direction: column;
            gap: 4px;
        }

        .meta-label {
            font-size: 12px;
            color: #666;
            font-weight: 600;
        }

        .meta-value {
            font-size: 14px;
            color: #333;
        }

        /* 버튼 그룹 */
        .button-group {
            display: flex;
            justify-content: space-between;
            gap: 16px;
            padding-bottom: 30px;
        }

        .button-group-right {
            display: flex;
            gap: 16px;
            justify-content: flex-end;
        }

        /* 진행률 그래프 */
        .course-progress-info {
            display: flex;
            justify-content: end;
            align-items: center;
        }

        /* helper progress styles removed (not used in static HTML) */

        .progress-percentage {
            font-size: 24px;
            font-weight: 700;
            color: var(--color-primary);
        }

        .progress-bar-container {
            width: 100%;
            height: 20px;
            background: #e9ecef;
            border-radius: 12px;
            overflow: hidden;
            position: relative;
        }

        .progress-bar {
            height: 100%;
            background: linear-gradient(90deg, var(--color-primary) 0%, #4a8fe7 100%);
            border-radius: 12px;
            transition: width 0.6s ease;
            position: relative;
        }

        .progress-bar::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(90deg, transparent 0%, rgba(255,255,255,0.3) 50%, transparent 100%);
            animation: shimmer 2s infinite;
        }

        @keyframes shimmer {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }

        /* 변경 이력 테이블 */
        .history-table {
            width: 100%;
            border-collapse: collapse;
            margin: 16px 0;
        }

        .history-table th,
        .history-table td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid var(--color-line-gray);;
            font-size: 13px;
        }

        .history-table th {
            background: #f8f9fa;
            font-weight: 600;
            color: #333;
        }

        .history-table td {
            color: #666;
        }

        .history-empty {
            text-align: center;
            padding: 40px;
            color: #999;
            font-size: 14px;
        }

        /* 학생 카드 스타일 및 호버 효과 */

        .student-card-container {
            display: flex;
            flex-wrap: wrap;
            gap: 12px;
        }

        /* 학생 위험점수 점 스타일 */
        .student-risk-dot {
            display: inline-block;
            width: 10px;
            height: 10px;
            border-radius: 50%;
            position: absolute;
            top: 8px;
            right: 8px;
        }

        .student-card {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 12px 24px 12px 16px;
            width: fit-content;
            display: flex;
            align-items: center;
            cursor: pointer;
            position: relative;
            color: var(--color-font-gray);
            transition: background 0.2s;
        }
        .student-card:hover {
            background: var(--color-line-gray);
        }

        .student-risk-dot.high { background: #dc3545; }
        .student-risk-dot.medium { background: #ffc107; }
        .student-risk-dot.low { background: #28a745; }
        .student-card .age {
            color: #888;
            font-size: 13px;
            font-weight: normal;
        }


        /* 반응형 */
        @media (max-width: 768px) {
            .form-row,
            .form-row-triple {
                grid-template-columns: 1fr;
            }

            .button-group {
                flex-direction: column;
            }
        }


        /* 토글 버튼 그룹 스타일 */
        /* 텍스트 토글 스타일 */
        .toggle-text-group {
            display: flex;
            align-items: center;
            gap: 0;
            /* margin-bottom: 12px; */
        }
        .toggle-text {
            font-size: 18px;
            color: #888;
            font-weight: 400;
            padding: 6px 18px;
            cursor: pointer;
            transition: color 0.2s, background 0.2s;
            border-radius: 6px;
        }
        .toggle-text.active {
            color: var(--color-primary);
            /* background: #f0f6ff; */
            font-weight: 700;
        }
        .toggle-text:hover:not(.active) {
            color: #333;
            /* background: #f5f5f5; */
        }
        .toggle-divider {
            color: #ccc;
            font-size: 18px;
            margin: 0 2px;
            user-select: none;
        }

        .button-container {
            width: 100%;
            display: flex;
            justify-content: space-between;
        }
    </style>
</head>
<body>
    <!-- 상단 헤더 -->
    <header class="header">
        <h1>과정/운영 관리 > 과정 관리 > 과정 상세</h1>
        <!-- icon -->
        <div class="icon-container">
            <div class="icon-box"><img src="/icons/bell.svg" alt="alert icon" style="width: 28px;"></div>
            <div class="icon-box" onClick="location.href='../admin-00-topmenu/admin-topmenu-user.html'"><img src="/icons/user.svg" alt="user icon" style="width: 30px;"></div>
            <div class="icon-box"><img src="/icons/setting.svg" alt="setting icon" style="width: 25px;"></div>
        </div>
    </header>

    <!-- 왼쪽 사이드바 -->
    <aside class="sidebar">
        <!-- 사이드바 메뉴 내용 -->

        <!-- logo-box -->
        <div class="logo-box">
            <img id="sidebarLogo" src="/logo-white.png" alt="logo" style="width: 130px;">
        </div>

        <!-- menu -->
        <nav class="menu">
            <ul>
                <li data-page="../admin-01-dashboard/admin-dashboard.html" onclick="handleMenuClick(this, '../admin-01-dashboard/admin-dashboard.html')">
                    <img src="../icons/01-dashboard.svg" alt="dashboard icon" style="width: 26px; margin-left:-2px; margin-right: 8px; vertical-align: middle; padding-bottom: 4px;">
                    <span class="menu-text">현황(대시보드)</span>
                </li>
                <li data-page="../admin-02-user/admin-user-trainee.html" onclick="handleMenuClick(this, '../admin-02-user/admin-user-trainee.html')">
                    <img src="../icons/02-user.svg" alt="user icon" style="width: 28px; margin-right: 8px; vertical-align: middle; padding-bottom: 4px;">
                    <span class="menu-text">사용자 관리</span>
                    <ul>
                        <li class="submenu" onclick="event.stopPropagation(); location.href='../admin-02-user/admin-user-trainee.html'">훈련생 관리</li>
                        <li class="submenu" onclick="event.stopPropagation(); location.href='../admin-02-user/admin-user-instructor.html'">강사 관리</li>
                        <li class="submenu" onclick="event.stopPropagation(); location.href='../admin-02-user/admin-user.html'">관리자 관리</li>
                    </ul>
                </li>
                <li data-page="../admin-03-courses/admin-course-edu.html" onclick="handleMenuClick(this, '../admin-03-courses/admin-courses-edu.html')">
                    <img src="../icons/03-course.svg" alt="course icon" style="width: 25px; margin-right: 8px; vertical-align: middle; padding-bottom: 4px;">
                    <span class="menu-text active_menu">과정/운영 관리</span>
                    <ul>
                        <li class="submenu active_menu" onclick="event.stopPropagation(); location.href='../admin-03-courses/admin-courses-edu.html'">과정 관리</li>
                        <li class="submenu" onclick="event.stopPropagation(); location.href='../admin-03-courses/admin-courses-schedule.html'">일정 관리</li>
                    </ul>
                </li>
                <li data-page="../admin-04-evaluation/admin-evaluation-assignment.html" onclick="handleMenuClick(this, '../admin-04-evaluation/admin-evaluation-assignment.html')">
                    <img src="../icons/04-evaluation.svg" alt="evaluation icon" style="width: 30px; margin-left:-4px; margin-right: 7px; vertical-align: middle; padding-bottom: 4px;">
                    <span class="menu-text">평가 관리</span>
                    <ul>
                        <li class="submenu" onclick="event.stopPropagation(); location.href='../admin-04-evaluation/admin-evaluation-question-bank.html'">문제 은행</li>
                        <li class="submenu" onclick="event.stopPropagation(); location.href='../admin-04-evaluation/admin-evaluation-assignment.html'">과제 관리</li>
                        <li class="submenu" onclick="event.stopPropagation(); location.href='../admin-04-evaluation/admin-evaluation-test.html'">시험 관리</li>
                        <li class="submenu" onclick="event.stopPropagation(); location.href='../admin-04-evaluation/admin-evaluation-result.html'">채점 및 결과 관리</li>
                        <li class="submenu" onclick="event.stopPropagation(); location.href='../admin-04-evaluation/admin-evaluation-monitoring.html'">평가 모니터링</li>
                    </ul>
                </li>
                <li data-page="../admin-05-attendance/admin-attendance.html" onclick="handleMenuClick(this, '../admin-05-attendance/admin-attendance.html')">
                    <img src="../icons/05-attendance.svg" alt="attendance icon" style="width: 28px; margin-right: 8px; vertical-align: middle; padding-bottom: 4px;">
                    <span class="menu-text">출결/이수 관리</span>
                    <ul>
                        <li class="submenu" onclick="event.stopPropagation(); location.href='../admin-05-attendance/admin-attendance.html'">출결현황</li>
                        <li class="submenu" onclick="event.stopPropagation(); location.href='../admin-05-attendance/admin-attendance-graduate.html'">이수 관리</li>
                        <li class="submenu" onclick="event.stopPropagation(); location.href='../admin-05-attendance/admin-attendance-survey.html'">설문조사 관리</li>
                    </ul>
                </li>
                <li data-page="../admin-06-support/admin-support-tutoring.html" onclick="handleMenuClick(this, '../admin-06-support/admin-support-tutoring.html')">
                    <img src="../icons/06-support.svg" alt="support icon" style="width: 25px; margin-right: 8px; vertical-align: middle; padding-bottom: 4px;">
                    <span class="menu-text">학습 지원</span>
                    <ul>
                        <li class="submenu" onclick="event.stopPropagation(); location.href='../admin-06-support/admin-support-tutoring.html'">튜터링/QnA</li>
                        <li class="submenu" onclick="event.stopPropagation(); location.href='../admin-06-support/admin-support-response.html'">응답현황</li>
                        <li class="submenu" onclick="event.stopPropagation(); location.href='../admin-06-support/admin-support-chat-monitoring.html'">채팅 모니터링</li>
                    </ul>
                </li>
                <li data-page="../admin-07-notice/admin-notice.html" onclick="handleMenuClick(this, '../admin-07-notice/admin-notice.html')" class="white-icon">
                    <img src="../icons/bell.svg" alt="notice icon" style="width: 26px; margin-right: 8px; vertical-align: middle; padding-bottom: 4px;">
                    <span class="menu-text">공지/알림</span>
                    <ul>
                        <li class="submenu" onclick="event.stopPropagation(); location.href='../admin-07-notice/admin-notice.html'">공지 관리</li>
                        <li class="submenu" onclick="event.stopPropagation(); location.href='../admin-07-notice/admin-notice-alarm.html'">알림 관리</li>
                    </ul>
                </li>
            </ul>
        </nav>
                <span class="logout" onclick="location.href='../01-login/login.html'">로그아웃 

            <svg xmlns="http://www.w3.org/2000/svg" height="20px" viewBox="0 -960 960 960" width="20px" fill="CurrentColor">
                <path d="M186.67-120q-27 0-46.84-19.83Q120-159.67 120-186.67v-586.66q0-27 19.83-46.84Q159.67-840 186.67-840h292.66v66.67H186.67v586.66h292.66V-120H186.67Zm470.66-176.67-47-48 102-102H360v-66.66h351l-102-102 47-48 184 184-182.67 182.66Z"/>
            </svg>
        </span>
    </aside>

    <!-- 토글 버튼 -->
    <div class="toggle-btn" onclick="toggleSidebar()">
        ◀
    </div>

    <!-- 메인 콘텐츠 -->
    <main class="main-content">
        <div class="form-wrap">
            
            <div class="section-header">
                <h2>과정 상세 정보</h2>
            </div>
            <!-- 1. 기본 정보 -->
            <div class="form-section">
                <h3 class="section-title">
                    기본 정보
                </h3>

                <div class="form-group">
                    <label class="form-label">과정명</label>
                    <div class="meta-value" id="courseName">풀스택 웹 개발 (React & Node.js)</div>
                </div>

                <div class="form-group">
                    <label class="form-label">과정 카테고리</label>
                    <div class="meta-value" id="category">KDT</div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">강사 이름</label>
                        <div class="meta-value" id="instructor">김민수 강사</div>
                    </div>

                    <div class="form-group">
                        <label class="form-label">운영 담당자 (관리자)</label>
                        <div class="meta-value" id="manager">이지은 관리자</div>
                    </div>
                </div>

                <div class="form-group">
                    <label class="form-label">과정 설명</label>
                    <div class="meta-value" id="description" style="line-height: 1.6;">React와 Node.js를 활용한 풀스택 웹 개발 과정입니다. 프론트엔드부터 백엔드까지 전반적인 웹 개발 스킬을 학습합니다.</div>
                </div>
            </div>

            <!-- 2. 운영 상태 -->
            <div class="form-section">
                <h3 class="section-title">
                    운영 상태
                </h3>

                <div class="form-group" style="display: flex; align-items: center;">
                    <label class="form-label" style="margin-bottom: 0; min-width: 65px;">운영 상태</label>
                    <div class="meta-value">
                        <span class="status-badge status-in-progress">활성</span>
                    </div>
                </div>

                <div class="form-row-triple">
                    <div class="form-group">
                        <label class="form-label">과목 개수</label>
                        <div class="meta-value" id="subjectCount">3개</div>
                    </div>

                    <div class="form-group">
                        <label class="form-label">과목 총 시간</label>
                        <div class="meta-value" id="totalSubjectHours">150시간</div>
                    </div>

                    <div class="form-group">
                        <label class="form-label">수강생 수</label>
                        <div class="meta-value" id="studentCount">28명</div>
                    </div>
                </div>
                
                <div class="form-management-chart">
                    <div class="course-progress-info">
                        <span class="progress-percentage">42%</span>
                    </div>

                    <!-- 진행률 그래프 -->
                    <div class="progress-bar-container">
                        <div class="progress-bar" style="width: 42%;"></div>
                    </div>
                </div>
            </div>

            <!-- 3. 운영 기간 -->
            <div class="form-section">
                <h3 class="section-title">
                    운영 기간
                </h3>

                <div class="form-group">
                    <label class="form-label">과정 기간</label>
                    <div class="meta-value" id="coursePeriod">2026-01-06 ~ 2026-06-30</div>
                </div>

                <div class="form-group">
                    <label class="form-label">요일별 수업 시간</label>
                    <div style="display: grid; gap: 8px;">
                        <div style="padding: 10px 12px; background: #f8f9fa; border-radius: 6px;">
                            <span style="font-weight: 600; color: #333; margin-right: 12px;">월요일:</span>
                            <span style="color: #666;">09:00 ~ 18:00</span>
                        </div>
                        <div style="padding: 10px 12px; background: #f8f9fa; border-radius: 6px;">
                            <span style="font-weight: 600; color: #333; margin-right: 12px;">화요일:</span>
                            <span style="color: #666;">09:00 ~ 18:00</span>
                        </div>
                        <div style="padding: 10px 12px; background: #f8f9fa; border-radius: 6px;">
                            <span style="font-weight: 600; color: #333; margin-right: 12px;">수요일:</span>
                            <span style="color: #666;">09:00 ~ 18:00</span>
                        </div>
                        <div style="padding: 10px 12px; background: #f8f9fa; border-radius: 6px;">
                            <span style="font-weight: 600; color: #333; margin-right: 12px;">목요일:</span>
                            <span style="color: #666;">09:00 ~ 18:00</span>
                        </div>
                        <div style="padding: 10px 12px; background: #f8f9fa; border-radius: 6px;">
                            <span style="font-weight: 600; color: #333; margin-right: 12px;">금요일:</span>
                            <span style="color: #666;">09:00 ~ 18:00</span>
                        </div>
                    </div>
                </div>

                <div class="form-row-triple">
                    <div class="form-group">
                        <label class="form-label">총 교육 기간 (주)</label>
                        <div class="meta-value" id="durationWeeks">26주</div>
                    </div>

                    <div class="form-group">
                        <label class="form-label">총 교육 기간 (개월)</label>
                        <div class="meta-value" id="durationMonths">6.0개월</div>
                    </div>

                    <div class="form-group">
                        <label class="form-label">총 교육 시간</label>
                        <div class="meta-value" id="totalHours">1,170시간</div>
                    </div>
                </div>

                <div class="form-group">
                    <label class="form-label">주당 수업 시간</label>
                    <div class="meta-value" id="weeklyHours">45시간/주</div>
                </div>
            </div>

            <!-- 4. 정원 및 모집 -->
            <div class="form-section">
                <h3 class="section-title">
                    정원 및 모집
                </h3>

                <div class="form-row-triple">
                    <div class="form-group">
                        <label class="form-label">정원 (모집 인원)</label>
                        <div class="meta-value" id="maxStudents">30명</div>
                    </div>

                    <div class="form-group">
                        <label class="form-label">최소 개설 인원</label>
                        <div class="meta-value" id="minStudents">20명</div>
                    </div>

                    <div class="form-group">
                        <label class="form-label">현재 수강 인원</label>
                        <div class="meta-value" id="currentStudents">28명</div>
                    </div>
                </div>

                <!-- 수강신청 학생 리스트 -->
                <div class="form-group">
                    <label class="form-label">수강신청 학생 리스트</label>
                    <div class="student-card-container">
                        <div class="student-card" onclick="goToStudentPage('hong98')">
                            <span>홍길동 <span class="age">(98)</span></span>
                            <span class="student-risk-dot high" title="높음"></span>
                        </div>
                        <div class="student-card" onclick="goToStudentPage('mina00')">
                            <span>김민아 <span class="age">(00)</span></span>
                            <span class="student-risk-dot medium" title="중간"></span>
                        </div>
                        <div class="student-card" onclick="goToStudentPage('soo99')">
                            <span>이수진 <span class="age">(99)</span></span>
                            <span class="student-risk-dot low" title="낮음"></span>
                        </div>
                    </div>
                        <p class="form-help" style="margin-top:8px;">이탈위험점수: <span style="color:#dc3545;font-weight:600;">● 높음</span> <span style="color:#ffc107;font-weight:600;">● 중간</span> <span style="color:#28a745;font-weight:600;">● 낮음</span></p>
                </div>
            </div>

            <!-- 5. 수강 정책 / 평가 기준 -->
            <div class="form-section">
                <h3 class="section-title">
                    수강 정책 / 평가 기준
                </h3>

                <div class="form-group">
                    <label class="form-label">출석 기준</label>
                    <div class="meta-value" id="attendanceRate">80% 이상</div>
                </div>

                <div class="form-group">
                    <label class="form-label">수료 기준</label>
                    <div class="meta-value" id="completionCriteria">출석, 시험, 과제</div>
                </div>

                <div class="form-group">
                    <label class="form-label">평가 요소</label>
                    <div class="meta-value" id="evaluationElements">시험, 과제, 프로젝트</div>
                </div>
            </div>

            <!-- 6. 비용 / 연계 정보 -->
            <div class="form-section">
                <h3 class="section-title">
                    비용 / 연계 정보
                </h3>

                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">수강료</label>
                        <div class="meta-value" id="tuitionFee">5,000,000원</div>
                    </div>

                    <div class="form-group">
                        <label class="form-label">자부담 비용</label>
                        <div class="meta-value" id="selfPayment">0원</div>
                    </div>
                </div>

                <div class="form-group">
                    <label class="form-label">결제 방식</label>
                    <div class="meta-value" id="paymentMethod">국비 지원</div>
                </div>

                <div class="form-group">
                    <label class="form-label">국비 과정 여부</label>
                    <div class="meta-value" id="isGovernmentFunded">예</div>
                </div>
            </div>

            <!-- 7. 관리용 메타 정보 -->
            <div class="form-section">
                <h3 class="section-title">
                    메타 정보
                </h3>

                <div class="meta-info-grid">
                    <div class="meta-item">
                        <span class="meta-label">과정 생성일</span>
                        <span class="meta-value" id="createdDate">-</span>
                    </div>
                    <div class="meta-item">
                        <span class="meta-label">최종 수정일</span>
                        <span class="meta-value" id="modifiedDate">-</span>
                    </div>
                    <div class="meta-item">
                        <span class="meta-label">생성 관리자</span>
                        <span class="meta-value" id="createdBy">-</span>
                    </div>
                    <div class="meta-item">
                        <span class="meta-label">최종 수정 관리자</span>
                        <span class="meta-value" id="modifiedBy">-</span>
                    </div>
                </div>

                <div class="form-group" style="margin-top: 20px;">
                    <label class="form-label">변경 이력 / 로그</label>
                    <table class="history-table">
                        <thead>
                            <tr>
                                <th>날짜</th>
                                <th>관리자</th>
                                <th>변경 내용</th>
                            </tr>
                        </thead>
                        <tbody id="historyTableBody">
                            <tr>
                                <td colspan="3" class="history-empty">변경 이력이 없습니다.</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- 버튼 그룹 -->
            <div class="button-group">
                <button type="button" class="big-btn btn-gray" onclick="deleteCourse()">삭제하기</button>
                <div class="button-group-right">
                    <button type="button" class="btn btn-back" onclick="goBack()">목록으로</button>
                    <button type="button" class="btn btn-save" onclick="editCourse()">수정하기</button>
                </div>
            </div>
        </div>
        
        <!-- 과목 관리 영역 -->
        <div class="subject-wrap">
            <div class="section-header">
                <h2>과정 상세 > 구성 과목</h2>
                <div class="toggle-text-group">
                    <span id="toggleContentEdit" class="toggle-text" onclick="location.href='admin-courses-edu-detail.html'">콘텐츠 편집</span>
                    <span class="toggle-divider">|</span>
                    <span id="toggleLessonEdit" class="toggle-text active">차시 편집</span>
                </div>

            </div>
            <div class="divider"></div>
            
            <div class="button-container">
                <div style="display:flex; gap:12px; align-items:center;">
                    <button class="btn btn-secondary" onclick="addSessionColumn()">+ 차시 추가</button>
                    <button id="btnAddContent" class="btn btn-secondary" onclick="addContentRow()">콘텐츠 추가</button>
                    <span id="contentCountInfo" style="font-size:15px; color:#666; margin-left:8px;"></span>
                </div>
                <div class="button-group-right">
                    <button class="btn btn-gray" onclick="autoGenerateSessions()">
                        자동 차시 생성
                    </button>
                    <button class="btn-excel" onclick="uploadExcel()">
                        <img src="/icons/excel.svg" alt="Excel icon">
                        <span>엑셀로 다운로드</span>
                    </button>
                </div>
            </div>

            <!-- 차시 관리 매트릭스 -->
            <div class="table-action-wrapper">
                <table id="sessionMatrix" class="history-table" style="min-width:800px;">
                    <colgroup>
                        <col style="width:30%">
                        <col style="width:40%">
                        <col style="width:20%">
                        <col style="width:5%">
                        <col style="width:5%">
                    </colgroup>
                    <thead>
                        <tr>
                            <th>과목</th>
                            <th>콘텐츠명</th>
                            <th>출결기준</th>
                            <th></th>
                            <th></th>
                        </tr>
                    </thead>
                    <tbody id="contentRows">
                        <tr id="sessionHeaderRow">
                            <th colspan="5">1 차시</th>
                        </tr>
                    </tbody>
                </table>
            </div>
            <div class="button-group-right">
                <button class="btn btn-save" onclick="saveSessionMatrix()">저장하기</button>
            </div>
            
        </div>
    </main>

    <!-- ...existing code... -->

    <script>
        // 과목별 콘텐츠 목록 (실제 환경에서는 DB에서 받아옴)
let subjectContentMap = {
    'subject-1': [
        { value: 'content-1', label: '콘텐츠 1' },
        { value: 'content-2', label: '콘텐츠 2' }
    ],
    'subject-2': [
        { value: 'content-3', label: '콘텐츠 3' },
        { value: 'content-4', label: '콘텐츠 4' }
    ]
};
let allSubjects = [
    { value: 'subject-1', label: '과목 1' },
    { value: 'subject-2', label: '과목 2' }
];

        // Session rows and content rows (matrix)
        // Initialize sessionCounter based on existing session header rows (th in tbody)
        let sessionCounter = document.querySelectorAll('#contentRows tr th').length || 0;

        // Adds a new session as a row under the table (tr with a th spanning the table)
        function addSessionColumn() {
            sessionCounter++;
            const tbody = document.querySelector('#contentRows');
            const theadRow = document.querySelector('#sessionMatrix thead tr');
            const colCount = theadRow.children.length;

            const tr = document.createElement('tr');
            tr.setAttribute('data-session-id', sessionCounter);

            const th = document.createElement('th');
            th.style.textAlign = 'center';
            th.colSpan = colCount;
            th.innerHTML = `
                <div style="display:flex; align-items:center; justify-content:space-between;">
                    <span style="font-weight:700;">${sessionCounter} 차시</span>
                    <button class="btn-small btn-gray" onclick="removeSessionColumn(${sessionCounter})">삭제</button>
                </div>
            `;

            tr.appendChild(th);
            tbody.appendChild(tr);
        }

        // Removes a session row by its id
        function removeSessionColumn(sessionId) {
            const tr = document.querySelector(`#contentRows tr[data-session-id="${sessionId}"]`);
            if (tr) tr.remove();
        }

        // 콘텐츠 중복 방지: 모든 select 옵션을 동적으로 갱신
        function addContentRow() {
            const tbody = document.getElementById('contentRows');
            const tr = document.createElement('tr');

            // subject column (select)
            const tdSubject = document.createElement('td');
            const subjectSelect = document.createElement('select');
            subjectSelect.innerHTML = '<option value="" disabled selected>과목 선택</option>' +
                allSubjects.map(s => `<option value="${s.value}">${s.label}</option>`).join('');
            subjectSelect.onchange = function() { handleSubjectChange(tr); };
            tdSubject.appendChild(subjectSelect);
            tr.appendChild(tdSubject);

            // content name column (select)
            const tdContent = document.createElement('td');
            const contentSelect = document.createElement('select');
            contentSelect.disabled = true;
            tdContent.appendChild(contentSelect);
            tr.appendChild(tdContent);

            // attendance column
            const tdAttendance = document.createElement('td');
            tdAttendance.innerHTML = `<input type="text" placeholder="출결기준">`;
            tr.appendChild(tdAttendance);

            // dynamic session columns: count of session ths = total ths - 4 (base 3 + action)
            const headerRow = document.querySelector('#sessionMatrix thead tr');
            const dynamicCount = Math.max(0, headerRow.children.length - 4);
            for (let i = 0; i < dynamicCount; i++) {
                const td = document.createElement('td');
                td.style.textAlign = 'center';
                td.innerHTML = 
                `<div style="display:flex; flex-direction:column; gap:4px; align-items:center;">
                    <button class="btn-small" onclick="moveRowUp(this)" title="위로 이동">▲</button>    
                    <button class="btn-small" onclick="moveRowDown(this)" title="아래로 이동">▼</button>    
                </div>`;
                tr.appendChild(td);
            }

            // action column
            const actionTd = document.createElement('td');
            actionTd.style.textAlign = 'center';
            actionTd.innerHTML = '<button class="btn-small btn-gray" onclick="removeContentRow(this)">삭제</button>';
            tr.appendChild(actionTd);

            tbody.appendChild(tr);
            updateAllContentSelectOptions();
        }

        // 모든 콘텐츠 목록 (실제 환경에서는 DB에서 받아옴)
        let allContents = [
            { value: 'content-1', label: '콘텐츠 1' },
            { value: 'content-2', label: '콘텐츠 2' },
            { value: 'content-3', label: '콘텐츠 3' },
            { value: 'content-4', label: '콘텐츠 4' }
        ];

        // 모든 콘텐츠 select 박스의 옵션을 동적으로 갱신 + 남은 콘텐츠 개수 UI 갱신 + 추가 버튼 제한
        function updateAllContentSelectOptions() {
            const tbody = document.getElementById('contentRows');
            const rows = Array.from(tbody.querySelectorAll('tr'));
            // 모든 row의 콘텐츠 select 중복 방지 및 과목별 옵션 표시
            let selectedContents = [];
            rows.forEach(tr => {
                const contentSelect = tr.querySelector('td:nth-child(2) select');
                if (contentSelect && contentSelect.value) {
                    selectedContents.push(contentSelect.value);
                }
            });

            rows.forEach(tr => {
                const subjectSelect = tr.querySelector('td:nth-child(1) select');
                const contentSelect = tr.querySelector('td:nth-child(2) select');
                if (!subjectSelect || !contentSelect) return;
                const subjectValue = subjectSelect.value;
                if (!subjectValue) {
                    contentSelect.innerHTML = '<option value="" disabled selected>과목을 먼저 선택하세요</option>';
                    contentSelect.disabled = true;
                } else {
                    const currentValue = contentSelect.value;
                    const allContents = subjectContentMap[subjectValue] || [];
                    // 중복 방지: 이미 선택된 콘텐츠는 옵션에서 제외(단, 현재 선택값은 유지)
                    const availableContents = allContents.filter(c => !selectedContents.includes(c.value) || c.value === currentValue);
                    let optionsHtml = '<option value="" disabled selected>콘텐츠 선택</option>';
                    availableContents.forEach(c => {
                        optionsHtml += `<option value="${c.value}"${c.value === currentValue ? ' selected' : ''}>${c.label}</option>`;
                    });
                    contentSelect.innerHTML = optionsHtml;
                    contentSelect.disabled = false;
                }
            });

            // 남은 콘텐츠 개수 UI 갱신 (전체 콘텐츠 - 사용된 콘텐츠)
            let totalContentCount = Object.values(subjectContentMap).reduce((acc, arr) => acc + arr.length, 0);
            let usedContentCount = selectedContents.length;
            const infoSpan = document.getElementById('contentCountInfo');
            if (infoSpan) {
                infoSpan.textContent = `남은 콘텐츠 ${totalContentCount - usedContentCount} / ${totalContentCount}`;
            }
            // 콘텐츠 추가 버튼 제한 (전체 row 수 >= 전체 콘텐츠 수)
            const btnAdd = document.getElementById('btnAddContent');
            if (btnAdd) {
                btnAdd.disabled = (rows.length - 1 >= totalContentCount); // -1: 헤더 row 제외
                btnAdd.style.opacity = btnAdd.disabled ? '0.5' : '1';
                btnAdd.style.cursor = btnAdd.disabled ? 'not-allowed' : 'pointer';
            }
        }
// 과목 select 변경 시 해당 row의 콘텐츠 select 옵션 갱신
function handleSubjectChange(tr) {
    updateAllContentSelectOptions();
}

        // 콘텐츠 select 박스 change 이벤트에서 옵션 갱신
        document.addEventListener('change', function(e) {
            if (e.target && e.target.closest('td') && e.target.tagName === 'SELECT') {
                updateAllContentSelectOptions();
            }
        });

        // 페이지 로드시 남은 콘텐츠 UI 갱신
        document.addEventListener('DOMContentLoaded', function() {
            updateAllContentSelectOptions();
        });

        function removeContentRow(btn) {
            const tr = btn.closest('tr');
            tr.remove();
            updateAllContentSelectOptions(); // 삭제 후 남은 콘텐츠/옵션 즉시 복원
        }

        // Move table row up/down within #contentRows
        function moveRowUp(btn) {
            const tr = btn.closest('tr');
            if (!tr) return;
            const prev = tr.previousElementSibling;
            if (prev) {
                tr.parentNode.insertBefore(tr, prev);
            }
        }

        function moveRowDown(btn) {
            const tr = btn.closest('tr');
            if (!tr) return;
            const next = tr.nextElementSibling;
            if (next) {
                tr.parentNode.insertBefore(next, tr);
            }
        }
        // 과목 추가 모달 열기/닫기
        function openSubjectModal() {
            document.getElementById('subjectModalOverlay').style.display = 'flex';
        }
        function closeSubjectModal() {
            document.getElementById('subjectModalOverlay').style.display = 'none';
        }
        function saveSubject() {
            // 저장 로직 구현 필요
            alert('과목이 저장되었습니다.');
            closeSubjectModal();
        }
        // 텍스트 토글 동작
        function setEditMode(mode) {
            const txtContent = document.getElementById('toggleContentEdit');
            const txtLesson = document.getElementById('toggleLessonEdit');
            if (mode === 'content') {
                txtContent.classList.add('active');
                txtLesson.classList.remove('active');
            } else {
                txtContent.classList.remove('active');
                txtLesson.classList.add('active');
            }
            // 실제 편집 모드 전환 로직은 여기에 추가
        }
        // 페이지 로드 시 메타 정보 설정
        document.addEventListener('DOMContentLoaded', function() {
            document.getElementById('createdDate').textContent = '2026-01-01';
            document.getElementById('modifiedDate').textContent = '2026-01-08';
            document.getElementById('createdBy').textContent = '이지은 관리자';
            document.getElementById('modifiedBy').textContent = '이지은 관리자';
            
            // 드래그 앤 드롭 초기화
            initDragAndDrop();
        });

        // 드래그 앤 드롭 기능
        let draggedElement = null;

        function initDragAndDrop() {
            const subjectItems = document.querySelectorAll('.subject-item');
            
            subjectItems.forEach(item => {
                item.addEventListener('dragstart', handleDragStart);
                item.addEventListener('dragover', handleDragOver);
                item.addEventListener('drop', handleDrop);
                item.addEventListener('dragend', handleDragEnd);
                item.addEventListener('dragenter', handleDragEnter);
                item.addEventListener('dragleave', handleDragLeave);
            });
        }

        function handleDragStart(e) {
            draggedElement = this;
            this.classList.add('dragging');
            e.dataTransfer.effectAllowed = 'move';
            e.dataTransfer.setData('text/html', this.innerHTML);
        }

        function handleDragOver(e) {
            if (e.preventDefault) {
                e.preventDefault();
            }
            e.dataTransfer.dropEffect = 'move';
            return false;
        }

        function handleDragEnter(e) {
            if (this !== draggedElement) {
                this.classList.add('drag-over');
            }
        }

        function handleDragLeave(e) {
            this.classList.remove('drag-over');
        }

        function handleDrop(e) {
            if (e.stopPropagation) {
                e.stopPropagation();
            }
            
            if (draggedElement !== this) {
                const subjectList = document.getElementById('subjectList');
                const allItems = [...subjectList.querySelectorAll('.subject-item')];
                const draggedIndex = allItems.indexOf(draggedElement);
                const targetIndex = allItems.indexOf(this);
                
                if (draggedIndex < targetIndex) {
                    this.parentNode.insertBefore(draggedElement, this.nextSibling);
                } else {
                    this.parentNode.insertBefore(draggedElement, this);
                }
            }
            
            this.classList.remove('drag-over');
            return false;
        }

        function handleDragEnd(e) {
            this.classList.remove('dragging');
            
            const subjectItems = document.querySelectorAll('.subject-item');
            subjectItems.forEach(item => {
                item.classList.remove('drag-over');
            });
        }

        // 수정하기 버튼
        function editCourse() {
            // 수정 페이지로 이동 (추후 구현)
            alert('수정 페이지로 이동합니다.');
            window.location.href = 'admin-courses-edu-update.html';
        }

        // 삭제하기 버튼
        function deleteCourse() {
            if (confirm('이 과정을 정말 삭제하시겠습니까?')) {
                alert('과정이 삭제되었습니다.');
                window.location.href = 'admin-courses-edu.html';
            }
        }

        // 과목 추가
        function addSubject() {
            // 과목 추가 페이지로 이동 또는 모달 열기
            window.location.href = 'admin-courses-edu-subject.html';
        }

        // 과목 수정
        function editSubject(subjectCode) {
            alert(`과목 ${subjectCode} 수정 페이지로 이동합니다.`);
            // window.location.href = `admin-courses-subject-update.html?subjectCode=${subjectCode}`;
        }

        // 과목 삭제
        function deleteSubject(subjectCode) {
            if (confirm(`과목 ${subjectCode}을(를) 삭제하시겠습니까?`)) {
                alert(`과목 ${subjectCode}이(가) 삭제되었습니다.`);
                // 실제로는 서버에 삭제 요청을 보내고 페이지를 새로고침하거나 해당 카드를 DOM에서 제거
                // location.reload();
            }
        }

        // 콘텐츠 추가
        function addContent(subjectCode) {
            // 과목 코드에 해당하는 content-list 찾기
            const subjectItem = event.target.closest('.subject-item');
            const contentList = subjectItem.querySelector('.content-list');
            
            // content-list가 닫혀있다면 열기
            if (!contentList.classList.contains('expanded')) {
                const contentId = contentList.id;
                toggleContent(contentId);
            }
            
            // 현재 컨텐츠 개수 확인
            const currentItems = contentList.querySelectorAll('.content-item');
            const newOrderNumber = currentItems.length + 1;
            const newContentCode = `CNT-${String(newOrderNumber).padStart(3, '0')}`;
            
            // 새 컨텐츠 아이템 생성
            const newContentItem = document.createElement('div');
            newContentItem.className = 'content-item';
            newContentItem.innerHTML = `
                <div class="content-order">${newOrderNumber}</div>
                <div class="content-icon">
                    <img src="../icons/content-video.png" alt="video">
                </div>
                <div class="content-title">새 콘텐츠 ${newOrderNumber}</div>
                <div class="content-meta">동영상 / 0분</div>
                <div class="content-move-buttons">
                    <button class="btn-move" onclick="moveContentUp('${contentList.id}', this.closest('.content-item'))" title="위로 이동">▲</button>
                    <button class="btn-move" onclick="moveContentDown('${contentList.id}', this.closest('.content-item'))" title="아래로 이동">▼</button>
                </div>
                <div class="content-actions">
                    <button class="btn-small" onclick="deleteContent('${subjectCode}', '${newContentCode}')">삭제</button>
                    <button class="btn-small" onclick="editContent('${subjectCode}', '${newContentCode}')">수정</button>
                    <button class="btn-small btn-start" onclick="startLearning('${newContentCode}')">학습 시작</button>
                </div>
            `;
            
            // content-list에 추가
            contentList.appendChild(newContentItem);
            
            // content-list 높이 재계산
            setTimeout(() => {
                const scrollHeight = contentList.scrollHeight;
                contentList.style.maxHeight = (scrollHeight + 40) + 'px';
            }, 10);
        }

        // 컨텐츠 목록 토글
        function toggleContent(contentId) {
            const contentList = document.getElementById(contentId);
            const subjectCard = contentList.previousElementSibling;
            
            if (contentList.classList.contains('expanded')) {
                // 닫기
                contentList.style.maxHeight = '0';
                contentList.classList.remove('expanded');
                subjectCard.classList.remove('expanded');
            } else {
                // 열기 - 실제 콘텐츠 높이 계산
                contentList.classList.add('expanded');
                subjectCard.classList.add('expanded');

                
                // 실제 콘텐츠 높이 계산 후 약간의 여유 공간 추가
                setTimeout(() => {
                    const scrollHeight = contentList.scrollHeight;
                    contentList.style.maxHeight = (scrollHeight + 40) + 'px'; // 여유 공간 40px 추가
                }, 10);
            }
        }

        // 컨텐츠 삭제
        function deleteContent(subjectCode, contentCode) {
            if (confirm(`콘텐츠 ${contentCode}를 삭제하시겠습니까?`)) {
                alert(`콘텐츠 ${contentCode}가 삭제되었습니다.`);
            }
        }

        // 컨텐츠 수정
        function editContent(subjectCode, contentCode) {
            alert(`콘텐츠 ${contentCode} 수정 페이지로 이동합니다.`);
            // window.location.href = `admin-courses-content-edit.html?subjectCode=${subjectCode}&contentCode=${contentCode}`;
        }

        // 학습 시작
        function startLearning(contentCode) {
            alert(`콘텐츠 ${contentCode} 학습을 시작합니다.`);
            // window.location.href = `learning-content.html?contentCode=${contentCode}`;
        }

        // 컨텐츠 위로 이동
        function moveContentUp(contentListId, contentItem) {
            event.stopPropagation();
            const previousItem = contentItem.previousElementSibling;
            if (previousItem) {
                contentItem.parentNode.insertBefore(contentItem, previousItem);
                updateContentOrderNumbers(contentListId);
            }
        }

        // 컨텐츠 아래로 이동
        function moveContentDown(contentListId, contentItem) {
            event.stopPropagation();
            const nextItem = contentItem.nextElementSibling;
            if (nextItem) {
                contentItem.parentNode.insertBefore(nextItem, contentItem);
                updateContentOrderNumbers(contentListId);
            }
        }

        // 컨텐츠 순서 번호 업데이트
        function updateContentOrderNumbers(contentListId) {
            const contentList = document.getElementById(contentListId);
            const contentItems = contentList.querySelectorAll('.content-item');
            contentItems.forEach((item, index) => {
                const orderElement = item.querySelector('.content-order');
                if (orderElement) {
                    orderElement.textContent = index + 1;
                }
            });
        }

        // 학생 상세 페이지 이동 함수
        function goToStudentPage(studentId) {
            // 실제 구현 시 studentId로 상세 페이지 이동
            window.location.href = `admin-user-trainee.html?student=${studentId}`;
        }

        // 저장 버튼 핸들러 (임시 구현)
        function saveSessionMatrix() {
            // TODO: 실제 저장 로직을 서버 API 호출로 구현
            alert('차시 및 콘텐츠가 저장되었습니다.');
            console.log('saveSessionMatrix called - implement server save here');
        }

        // 자동 차시 생성 구현

        function autoGenerateSessions() {
            const tbody = document.getElementById('contentRows');
            tbody.innerHTML = '';
            let sessionNum = 1;
            for (const subject of allSubjects) {
                // 차시 header row
                const thTr = document.createElement('tr');
                thTr.setAttribute('data-session-id', sessionNum);
                const th = document.createElement('th');
                th.colSpan = 5;
                th.style.textAlign = 'center';
                th.innerHTML = `<div style="display:flex; align-items:center; justify-content:space-between;"><span style="font-weight:700;">${sessionNum} 차시</span></div>`;
                thTr.appendChild(th);
                tbody.appendChild(thTr);
                sessionNum++;
                // 해당 과목의 콘텐츠 tr 생성
                const contents = subjectContentMap[subject.value] || [];
                for (const content of contents) {
                    const tr = document.createElement('tr');
                    // 과목 select
                    const tdSubject = document.createElement('td');
                    const subjectSelect = document.createElement('select');
                    subjectSelect.innerHTML = '<option value="" disabled>과목 선택</option>' +
                        allSubjects.map(s => `<option value="${s.value}"${s.value===subject.value?' selected':''}>${s.label}</option>`).join('');
                    tdSubject.appendChild(subjectSelect);
                    tr.appendChild(tdSubject);
                    // 콘텐츠 select
                    const tdContent = document.createElement('td');
                    const contentSelect = document.createElement('select');
                    contentSelect.innerHTML = `<option value="" disabled>콘텐츠 선택</option>` +
                        contents.map(c => `<option value="${c.value}"${c.value===content.value?' selected':''}>${c.label}</option>`).join('');
                    tdContent.appendChild(contentSelect);
                    tr.appendChild(tdContent);
                    // 출결기준
                    const tdAttendance = document.createElement('td');
                    tdAttendance.innerHTML = `<input type="text" placeholder="출결기준">`;
                    tr.appendChild(tdAttendance);
                    // 이동/삭제 버튼
                    const tdMove = document.createElement('td');
                    tdMove.style.textAlign = 'center';
                    tdMove.innerHTML = `<div style="display:flex; flex-direction:column; gap:4px; align-items:center;"><button class="btn-small" onclick="moveRowUp(this)" title="위로 이동">▲</button><button class="btn-small" onclick="moveRowDown(this)" title="아래로 이동">▼</button></div>`;
                    tr.appendChild(tdMove);
                    const tdAction = document.createElement('td');
                    tdAction.style.textAlign = 'center';
                    tdAction.innerHTML = '<button class="btn-small btn-gray" onclick="removeContentRow(this)">삭제</button>';
                    tr.appendChild(tdAction);
                    tbody.appendChild(tr);
                }
            }
            updateAllContentSelectOptions();
        }
    </script>
</body>
</html>