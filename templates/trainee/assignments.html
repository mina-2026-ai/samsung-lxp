<!DOCTYPE html>
<html lang="ko">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="/static/css/basic-form-trainee.css">
	<link rel="stylesheet" href="/static/css/btn-style.css">
	<!-- <link rel="stylesheet" href="/static/css/trainee/assignments.css">
	<script src="/static/js/trainee/assignments.js" defer></script> -->
	<title>Samsung Academy LXP</title>
</head>
<body>
	<main>
		<section class="main-content-top">
			<div class="main-wrap">
				<h2>과제</h2>
			</div>
		</section>
		
		<section class="main-content main-wrap">
<!-- 시험/과제 > 과제 : 학생용 (안전 템플릿: 먹통 방지) -->
<div class="task-page">

  <div class="page-head">
    <div class="title-wrap">
      <h2 class="page-title">과제</h2>
      <p class="page-desc">내 과제를 확인하고 제출할 수 있어요.</p>
    </div>
  </div>

  <!-- 필터 -->
  <div class="filter-bar">
    <div class="filter-left">
      <div class="control inline">
        <label class="control-label" for="tStatus">상태</label>
        <select id="tStatus" class="control-input">
          <option value="ALL">전체</option>
          <option value="ONGOING">진행중</option>
          <option value="SUBMITTED">제출완료</option>
          <option value="LATE">미제출(마감)</option>
        </select>
      </div>

      <div class="control inline">
        <label class="control-label" for="tKeyword">검색</label>
        <input id="tKeyword" class="control-input" placeholder="과제명/과정 검색" />
      </div>
    </div>

    <div class="filter-right">
      <div class="control inline">
        <label class="control-label" for="tSort">정렬</label>
        <select id="tSort" class="control-input">
          <option value="DUE_SOON">마감 임박순</option>
          <option value="DUE_LATE">마감 여유순</option>
          <option value="NEWEST">최신순</option>
        </select>
      </div>
      <button type="button" class="btn ghost" id="tReset">초기화</button>
    </div>
  </div>

  <!-- 카드 리스트 -->
  <div class="card-grid" id="taskCardList"></div>
  <div class="list-hint" id="taskHint">-</div>

</div>

<!-- ===== 과제 상세 모달(간단) ===== -->
<div class="modal-backdrop" id="taskDetailBackdrop" aria-hidden="true" style="display:none;">
  <div class="modal" role="dialog" aria-modal="true" aria-labelledby="taskDetailTitle">
    <div class="modal-head">
      <div>
        <h3 id="taskDetailTitle" class="modal-title">과제 상세</h3>
        <p class="modal-sub" id="taskDetailSub">-</p>
      </div>
      <button type="button" class="btn icon" id="taskDetailClose" aria-label="닫기">✕</button>
    </div>
    <div class="modal-body">
      <div class="detail-grid">
        <div class="detail-item"><div class="detail-label">과정</div><div class="detail-value" id="dCourse">-</div></div>
        <div class="detail-item"><div class="detail-label">차시</div><div class="detail-value" id="dSession">-</div></div>
        <div class="detail-item"><div class="detail-label">마감</div><div class="detail-value" id="dDeadline">-</div></div>
        <div class="detail-item"><div class="detail-label">상태</div><div class="detail-value" id="dStatus">-</div></div>
      </div>
      <div class="section-divider"></div>
      <div class="modal-section">
        <div class="section-title">과제 설명</div>
        <div class="desc" id="dDesc">-</div>
      </div>
    </div>
    <div class="modal-foot">
      <button type="button" class="btn primary" id="taskDetailClose2">닫기</button>
    </div>
  </div>
</div>

<!-- ===== 과제 제출 모달(이전 모달 최소형 포함) ===== -->
<div class="as-modal-backdrop" id="asModalBackdrop" aria-hidden="true" style="display:none;">
  <div class="as-modal" role="dialog" aria-modal="true" aria-labelledby="asModalTitle">
    <div class="as-modal-head">
      <div class="as-head-left">
        <h3 id="asModalTitle" class="as-modal-title">과제 제출</h3>
        <p class="as-modal-sub" id="asModalSub">-</p>
      </div>
      <button type="button" class="as-btn icon" id="asBtnClose" aria-label="닫기">✕</button>
    </div>

    <div class="as-modal-body">
      <div class="as-info-card">
        <div class="as-info-top">
          <div class="as-assignment-title" id="asTitle">-</div>
          <div class="as-badges" id="asBadges"></div>
        </div>
        <div class="as-info-meta">
          <div class="as-meta-item"><span class="as-meta-k">마감</span><span class="as-meta-v" id="asDue">-</span></div>
          <div class="as-meta-item"><span class="as-meta-k">상태</span><span class="as-meta-v" id="asStatus">-</span></div>
          <div class="as-meta-item"><span class="as-meta-k">재제출</span><span class="as-meta-v" id="asResubmit">-</span></div>
        </div>
        <div class="as-desc" id="asDesc">-</div>
      </div>

      <div class="as-form-card">
        <div class="as-section-title">제출 내용</div>

        <div class="as-block" id="asBlockFile" style="display:none;">
          <div class="as-block-head">
            <div class="as-block-title">문서 제출</div>
            <div class="as-block-hint">파일 업로드</div>
          </div>

          <label class="as-dropzone" for="asFileInput" id="asDropzone">
            <input type="file" id="asFileInput" multiple style="display:none;" />
            <div class="as-drop-main">
              <div class="as-drop-strong">클릭하여 파일 업로드</div>
              <div class="as-drop-sub">여러 파일 가능</div>
            </div>
            <button type="button" class="as-btn ghost" id="asBtnBrowse">파일 선택</button>
          </label>
          <div class="as-file-list" id="asFileList"></div>
        </div>

        <div class="as-block" id="asBlockLink" style="display:none;">
          <div class="as-block-head">
            <div class="as-block-title">링크 제출</div>
            <div class="as-block-hint">URL 입력</div>
          </div>
          <input type="url" id="asLinkInput" class="as-input" placeholder="https://example.com" />
        </div>

        <div class="as-block" id="asBlockText" style="display:none;">
          <div class="as-block-head">
            <div class="as-block-title">텍스트 입력</div>
            <div class="as-block-hint">내용 작성</div>
          </div>
          <textarea id="asTextInput" class="as-textarea" placeholder="내용을 입력하세요."></textarea>
          <div class="as-counter"><span id="asTextCount">0</span> / 5000</div>
        </div>

        <div class="as-alert" id="asAlert" style="display:none;"></div>
      </div>
    </div>

    <div class="as-modal-foot">
      <button type="button" class="as-btn ghost" id="asBtnDraft">임시저장</button>
      <button type="button" class="as-btn primary" id="asBtnSubmit">제출하기</button>
    </div>
  </div>
</div>

<style>
  /* ===== page ===== */
  .task-page{ display:flex; flex-direction:column; gap:14px; }
  .page-head{ padding:18px 18px 0 18px; }
  .page-title{ margin:0; font-size:22px; font-weight:900; color:#111; }
  .page-desc{ margin:6px 0 0 0; color:#666; font-size:13px; }

  .filter-bar{
    display:flex; justify-content:space-between; gap:12px; align-items:center;
    padding:14px 18px; background:#fff; border:1px solid #e9e9e9; border-radius:14px; margin:0 18px;
  }
  .filter-left,.filter-right{ display:flex; align-items:center; gap:14px; flex-wrap:wrap; }
  .control.inline{ display:flex; align-items:center; gap:10px; }
  .control-label{ font-size:12px; color:#666; font-weight:800; white-space:nowrap; }
  .control-input{
    height:38px; padding:8px 10px; border:1px solid #d6d6d6; border-radius:8px; background:#fff;
    font-size:14px; color:#111; outline:none;
  }
  .control-input:focus{ border-color:#6b8cff; box-shadow:0 0 0 3px rgba(107,140,255,0.15); }

  .btn{
    height:38px; padding:0 14px; border-radius:10px; border:1px solid transparent;
    cursor:pointer; font-weight:800; font-size:14px; background:#f3f5f7; color:#111;
  }
  .btn.primary{ background:#1e6bff; color:#fff; }
  .btn.ghost{ background:transparent; border-color:#d6d6d6; }
  .btn.icon{ width:38px; padding:0; background:transparent; border:1px solid #e6e6e6; }

  .card-grid{
    margin:0 18px; display:grid;
    grid-template-columns: repeat(3, minmax(240px, 1fr));
    gap:12px;
  }
  .card{
    background:#fff; border:1px solid #e9e9e9; border-radius:14px; padding:14px;
    display:flex; flex-direction:column; gap:8px;
  }
  .card-title{ font-weight:900; color:#111; font-size:16px; }
  .card-meta{ color:#666; font-size:13px; font-weight:800; }
  .card-row{ display:flex; justify-content:space-between; gap:10px; align-items:center; }
  .badge{
    display:inline-flex; align-items:center; height:26px; padding:0 10px; border-radius:999px;
    font-size:12px; font-weight:900; border:1px solid #e6e6e6; background:#fff;
  }
  .badge.ongoing{ border-color:rgba(30,107,255,0.25); background:rgba(30,107,255,0.08); color:#1e6bff; }
  .badge.submitted{ border-color:rgba(0,180,120,0.25); background:rgba(0,180,120,0.10); color:#007a52; }
  .badge.late{ border-color:rgba(255,59,48,0.25); background:rgba(255,59,48,0.10); color:#b42318; }

  .card-actions{ display:flex; gap:10px; margin-top:8px; flex-wrap:wrap; }
  .list-hint{ margin:0 18px 18px 18px; font-size:12px; color:#777; font-weight:800; }

  @media (max-width: 980px){ .card-grid{ grid-template-columns: repeat(2, minmax(240px, 1fr)); } }
  @media (max-width: 640px){ .card-grid{ grid-template-columns: 1fr; } }

  /* ===== generic modal (detail) ===== */
  .modal-backdrop{
    position:fixed; inset:0; background:rgba(0,0,0,0.45);
    display:flex; justify-content:center; align-items:center; z-index:9999; padding:18px;
  }
  .modal{
    width:min(860px, 96vw); max-height:92vh; background:#fff; border-radius:16px; overflow:hidden;
    border:1px solid rgba(255,255,255,0.25); display:flex; flex-direction:column;
  }
  .modal-head{
    padding:16px 16px 12px 16px; display:flex; justify-content:space-between; gap:12px;
    border-bottom:1px solid #eee; background:#fff; align-items:flex-start;
  }
  .modal-title{ margin:0; font-size:18px; font-weight:900; color:#111; }
  .modal-sub{ margin:6px 0 0 0; font-size:12px; color:#777; }
  .modal-body{ padding:14px 16px; overflow-y:auto; }
  .modal-foot{ padding:12px 16px 16px 16px; border-top:1px solid #eee; background:#fff; display:flex; justify-content:flex-end; }

  .detail-grid{ display:grid; grid-template-columns: repeat(2, minmax(220px, 1fr)); gap:10px 14px; }
  .detail-item{ border:1px solid #f0f0f0; border-radius:12px; padding:10px 12px; background:#fafbfc; }
  .detail-label{ font-size:12px; color:#666; font-weight:800; }
  .detail-value{ margin-top:6px; font-size:14px; font-weight:900; color:#111; }
  .section-divider{ height:1px; background:#eee; margin:14px 0; }
  .section-title{ font-size:13px; font-weight:900; color:#111; margin-bottom:10px; }
  .desc{ font-size:13px; color:#444; line-height:1.6; white-space:pre-line; }

  /* ===== assignment submit modal (namespaced minimal) ===== */
  .as-btn{ height:38px; padding:0 14px; border-radius:10px; border:1px solid transparent; cursor:pointer; font-weight:900; background:#f3f5f7; }
  .as-btn.primary{ background:#1e6bff; color:#fff; }
  .as-btn.ghost{ background:transparent; border-color:#d6d6d6; color:#111; }
  .as-btn.icon{ width:38px; padding:0; background:transparent; border:1px solid #e6e6e6; }

  .as-modal-backdrop{ position:fixed; inset:0; background:rgba(0,0,0,0.45); display:flex; justify-content:center; align-items:center; z-index:9999; padding:18px; }
  .as-modal{ width:min(920px,96vw); max-height:92vh; background:#fff; border-radius:16px; overflow:hidden; border:1px solid rgba(255,255,255,0.25); display:flex; flex-direction:column; }
  .as-modal-head{ padding:16px 16px 12px 16px; display:flex; justify-content:space-between; gap:12px; border-bottom:1px solid #eee; background:#fff; align-items:flex-start; }
  .as-modal-title{ margin:0; font-size:18px; font-weight:900; color:#111; }
  .as-modal-sub{ margin:6px 0 0 0; font-size:12px; color:#777; }
  .as-modal-body{ padding:14px 16px; overflow-y:auto; display:flex; flex-direction:column; gap:12px; }
  .as-modal-foot{ padding:12px 16px 16px 16px; border-top:1px solid #eee; background:#fff; display:flex; justify-content:flex-end; gap:10px; }

  .as-info-card,.as-form-card{ border:1px solid #e9e9e9; border-radius:14px; background:#fff; padding:14px; }
  .as-info-top{ display:flex; justify-content:space-between; gap:10px; align-items:flex-start; }
  .as-assignment-title{ font-size:16px; font-weight:900; color:#111; }
  .as-badges{ display:flex; gap:8px; flex-wrap:wrap; justify-content:flex-end; }
  .as-badge{ display:inline-flex; align-items:center; height:26px; padding:0 10px; border-radius:999px; font-size:12px; font-weight:900; border:1px solid #e6e6e6; }
  .as-badge.type{ border-color:rgba(30,107,255,0.25); background:rgba(30,107,255,0.08); color:#1e6bff; }
  .as-badge.warn{ border-color:rgba(255,162,0,0.25); background:rgba(255,162,0,0.10); color:#a56600; }
  .as-badge.state{ border-color:rgba(0,180,120,0.25); background:rgba(0,180,120,0.10); color:#007a52; }

  .as-info-meta{ display:flex; gap:14px; flex-wrap:wrap; margin-top:10px; }
  .as-meta-item{ background:#fafbfc; border:1px solid #f0f0f0; border-radius:12px; padding:10px 12px; display:flex; gap:10px; align-items:center; }
  .as-meta-k{ font-size:12px; color:#666; font-weight:900; }
  .as-meta-v{ font-size:13px; color:#111; font-weight:900; }
  .as-desc{ margin-top:10px; font-size:13px; color:#444; line-height:1.6; white-space:pre-line; }

  .as-section-title{ font-size:13px; font-weight:900; color:#111; margin-bottom:10px; }
  .as-block{ border:1px solid #f0f0f0; border-radius:12px; padding:12px; background:#fafbfc; }
  .as-block-head{ display:flex; justify-content:space-between; gap:10px; align-items:flex-start; margin-bottom:10px; }
  .as-block-title{ font-weight:900; color:#111; }
  .as-block-hint{ font-size:12px; color:#777; font-weight:800; }

  .as-input{ width:100%; height:38px; padding:8px 10px; border:1px solid #d6d6d6; border-radius:10px; outline:none; }
  .as-textarea{ width:100%; min-height:140px; padding:10px 12px; border:1px solid #d6d6d6; border-radius:12px; outline:none; resize:vertical; }
  .as-counter{ margin-top:8px; font-size:12px; color:#777; text-align:right; font-weight:900; }

  .as-dropzone{ border:1px dashed #cfd6e4; border-radius:14px; background:#fff; padding:14px; display:flex; justify-content:space-between; gap:12px; align-items:center; cursor:pointer; }
  .as-file-list{ margin-top:10px; display:flex; flex-direction:column; gap:8px; }
  .as-file-item{ display:flex; justify-content:space-between; gap:10px; align-items:center; padding:10px 12px; border:1px solid #f0f0f0; border-radius:12px; background:#fff; }
  .as-file-name{ font-weight:900; font-size:13px; overflow:hidden; text-overflow:ellipsis; white-space:nowrap; }
  .as-mini-btn{ height:30px; padding:0 10px; border-radius:10px; border:1px solid #dfe3ea; background:#fff; cursor:pointer; font-weight:900; font-size:12px; }
  .as-alert{ margin-top:10px; padding:10px 12px; border-radius:12px; border:1px solid rgba(255,59,48,0.25); background:rgba(255,59,48,0.08); color:#b42318; font-weight:900; font-size:13px; }
</style>

<script>
  // ===== DATA (더미) =====
  // status: ONGOING / SUBMITTED / LATE
  // submitType: FILE / LINK / TEXT / FILE_TEXT
  let TASKS = [
    { id:"A1", name:"과제 1 - 연산자 요약", course:"풀스택 웹 개발", session:"3차시", status:"ONGOING", deadline:"2026-02-01 23:59", submitType:"FILE_TEXT", allowResubmit:true, description:"PDF 1개 + 텍스트 요약 5줄 이상" },
    { id:"A2", name:"과제 2 - DOM 실습", course:"풀스택 웹 개발", session:"6차시", status:"SUBMITTED", deadline:"2026-01-15 23:59", submitType:"LINK", allowResubmit:false, description:"배포 링크 제출" },
    { id:"A3", name:"과제 3 - Python 기초", course:"AI 활용 실무", session:"2차시", status:"LATE", deadline:"2026-01-10 23:59", submitType:"FILE", allowResubmit:false, description:"과제 문서 업로드" }
  ];

  // ===== DOM =====
  const tStatus = document.getElementById("tStatus");
  const tKeyword = document.getElementById("tKeyword");
  const tSort = document.getElementById("tSort");
  const tReset = document.getElementById("tReset");
  const taskCardList = document.getElementById("taskCardList");
  const taskHint = document.getElementById("taskHint");

  // Detail modal DOM
  const taskDetailBackdrop = document.getElementById("taskDetailBackdrop");
  const taskDetailClose = document.getElementById("taskDetailClose");
  const taskDetailClose2 = document.getElementById("taskDetailClose2");
  const taskDetailSub = document.getElementById("taskDetailSub");
  const dCourse = document.getElementById("dCourse");
  const dSession = document.getElementById("dSession");
  const dDeadline = document.getElementById("dDeadline");
  const dStatus = document.getElementById("dStatus");
  const dDesc = document.getElementById("dDesc");

  // Submit modal DOM
  const asModalBackdrop = document.getElementById("asModalBackdrop");
  const asBtnClose = document.getElementById("asBtnClose");
  const asBtnBrowse = document.getElementById("asBtnBrowse");
  const asFileInput = document.getElementById("asFileInput");
  const asDropzone = document.getElementById("asDropzone");
  const asFileList = document.getElementById("asFileList");
  const asTitle = document.getElementById("asTitle");
  const asBadges = document.getElementById("asBadges");
  const asDue = document.getElementById("asDue");
  const asStatusEl = document.getElementById("asStatus");
  const asResubmit = document.getElementById("asResubmit");
  const asDesc = document.getElementById("asDesc");
  const asModalSub = document.getElementById("asModalSub");
  const asBlockFile = document.getElementById("asBlockFile");
  const asBlockLink = document.getElementById("asBlockLink");
  const asBlockText = document.getElementById("asBlockText");
  const asLinkInput = document.getElementById("asLinkInput");
  const asTextInput = document.getElementById("asTextInput");
  const asTextCount = document.getElementById("asTextCount");
  const asAlert = document.getElementById("asAlert");
  const asBtnDraft = document.getElementById("asBtnDraft");
  const asBtnSubmit = document.getElementById("asBtnSubmit");

  // ===== State =====
  const state = { status:"ALL", keyword:"", sort:"DUE_SOON", list:[] };
  let currentTask = null;
  let asFiles = [];
  const TEXT_LIMIT = 5000;

  // ===== Utils =====
  const esc = (s)=>String(s??"").replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;").replaceAll('"',"&quot;").replaceAll("'","&#039;");
  const badgeClass = (st)=> st==="ONGOING"?"ongoing": st==="SUBMITTED"?"submitted":"late";
  const badgeLabel = (st)=> st==="ONGOING"?"진행중": st==="SUBMITTED"?"제출완료":"미제출(마감)";
  const fmtBytes = (b)=>{ const u=["B","KB","MB","GB"]; let i=0,v=b; while(v>=1024&&i<u.length-1){v/=1024;i++;} return `${v.toFixed(v>=10||i===0?0:1)}${u[i]}`; };

  function filterTasks(){
    let list = [...TASKS];

    if (state.status !== "ALL") list = list.filter(t => t.status === state.status);
    if (state.keyword.trim()){
      const k = state.keyword.trim().toLowerCase();
      list = list.filter(t => `${t.name} ${t.course}`.toLowerCase().includes(k));
    }

    if (state.sort === "DUE_SOON") list.sort((a,b)=> (a.deadline||"").localeCompare(b.deadline||""));
    if (state.sort === "DUE_LATE") list.sort((a,b)=> (b.deadline||"").localeCompare(a.deadline||""));
    if (state.sort === "NEWEST") list.sort((a,b)=> (b.id||"").localeCompare(a.id||""));

    return list;
  }

  function render(){
    state.list = filterTasks();

    taskCardList.innerHTML = state.list.length ? state.list.map(t => `
      <div class="card" data-id="${esc(t.id)}">
        <div class="card-title">${esc(t.name)}</div>
        <div class="card-meta">${esc(t.course)} / ${esc(t.session)}</div>

        <div class="card-row">
          <span class="badge ${badgeClass(t.status)}">${badgeLabel(t.status)}</span>
          <div style="color:#777;font-size:12px;font-weight:800;">마감: ${esc(t.deadline)}</div>
        </div>

        <div class="card-actions">
          <button type="button" class="btn ghost" data-action="detail" data-id="${esc(t.id)}">상세보기</button>
          ${t.status === "ONGOING"
            ? `<button type="button" class="btn primary" data-action="submit" data-id="${esc(t.id)}">제출하기</button>`
            : ``}
        </div>
      </div>
    `).join("") : `<div style="margin:0 18px;color:#777;font-weight:800;">과제가 없습니다.</div>`;

    taskHint.textContent = `전체 ${state.list.length}건`;
  }

  // ===== Detail modal =====
  function openDetail(task){
    taskDetailSub.textContent = `${task.id} · ${task.course} / ${task.session}`;
    dCourse.textContent = task.course;
    dSession.textContent = task.session;
    dDeadline.textContent = task.deadline;
    dStatus.textContent = badgeLabel(task.status);
    dDesc.textContent = task.description || "-";

    taskDetailBackdrop.style.display = "flex";
    taskDetailBackdrop.setAttribute("aria-hidden","false");
    document.body.style.overflow = "hidden";
  }
  function closeDetail(){
    taskDetailBackdrop.style.display = "none";
    taskDetailBackdrop.setAttribute("aria-hidden","true");
    document.body.style.overflow = "";
  }
  taskDetailClose.addEventListener("click", closeDetail);
  taskDetailClose2.addEventListener("click", closeDetail);
  taskDetailBackdrop.addEventListener("click",(e)=>{ if(e.target===taskDetailBackdrop) closeDetail(); });

  // ===== Submit modal =====
  function showAsAlert(msg){ asAlert.style.display="block"; asAlert.textContent=msg; }
  function hideAsAlert(){ asAlert.style.display="none"; asAlert.textContent=""; }

  function setBlocks(type){
    asBlockFile.style.display="none";
    asBlockLink.style.display="none";
    asBlockText.style.display="none";
    if(type==="FILE") asBlockFile.style.display="block";
    if(type==="LINK") asBlockLink.style.display="block";
    if(type==="TEXT") asBlockText.style.display="block";
    if(type==="FILE_TEXT"){ asBlockFile.style.display="block"; asBlockText.style.display="block"; }
  }

  function renderAsBadges(task){
    const typeMap = { FILE:"문서 제출", LINK:"링크 제출", TEXT:"텍스트 입력", FILE_TEXT:"문서+텍스트" };
    const type = `<span class="as-badge type">${typeMap[task.submitType] || "-"}</span>`;
    const submitted = task.status === "SUBMITTED";
    const st = submitted ? `<span class="as-badge state">제출됨</span>` : `<span class="as-badge warn">미제출</span>`;
    const re = task.allowResubmit ? `<span class="as-badge type">재제출 가능</span>` : `<span class="as-badge warn">재제출 불가</span>`;
    asBadges.innerHTML = type + st + re;
  }

  function renderFiles(){
    if(!asFiles.length){
      asFileList.innerHTML = `<div class="as-file-item"><div class="as-file-name">업로드된 파일이 없어요.</div><div style="color:#777;font-size:12px;font-weight:800;">-</div></div>`;
      return;
    }
    asFileList.innerHTML = asFiles.map(f=>`
      <div class="as-file-item">
        <div style="min-width:0;">
          <div class="as-file-name">${esc(f.file.name)}</div>
          <div style="color:#777;font-size:12px;font-weight:800;">${fmtBytes(f.file.size)}</div>
        </div>
        <button type="button" class="as-mini-btn" data-remove="${f.id}">삭제</button>
      </div>
    `).join("");
  }

  asFileList.addEventListener("click",(e)=>{
    const btn = e.target.closest("[data-remove]");
    if(!btn) return;
    const id = btn.getAttribute("data-remove");
    asFiles = asFiles.filter(x=>x.id!==id);
    renderFiles();
  });

  function openSubmit(task){
    currentTask = task;
    asFiles = [];
    asLinkInput.value = "";
    asTextInput.value = "";
    asTextCount.textContent = "0";
    hideAsAlert();

    asTitle.textContent = task.name;
    asDue.textContent = task.deadline;
    asStatusEl.textContent = badgeLabel(task.status);
    asResubmit.textContent = task.allowResubmit ? "가능" : "불가";
    asDesc.textContent = task.description || "-";
    asModalSub.textContent = `${task.id} · ${task.course} / ${task.session}`;

    renderAsBadges(task);
    setBlocks(task.submitType);
    renderFiles();

    asModalBackdrop.style.display = "flex";
    asModalBackdrop.setAttribute("aria-hidden","false");
    document.body.style.overflow = "hidden";
  }
  function closeSubmit(){
    asModalBackdrop.style.display = "none";
    asModalBackdrop.setAttribute("aria-hidden","true");
    document.body.style.overflow = "";
    currentTask = null;
  }
  asBtnClose.addEventListener("click", closeSubmit);
  asModalBackdrop.addEventListener("click",(e)=>{ if(e.target===asModalBackdrop) closeSubmit(); });

  asBtnBrowse.addEventListener("click",(e)=>{ e.preventDefault(); asFileInput.click(); });
  asFileInput.addEventListener("change",(e)=>{
    const files = Array.from(e.target.files || []);
    for(const file of files){
      asFiles.push({ id: crypto.randomUUID(), file });
    }
    renderFiles();
    asFileInput.value = "";
  });

  asTextInput.addEventListener("input",()=>{
    let v = asTextInput.value || "";
    if(v.length > TEXT_LIMIT){ v = v.slice(0,TEXT_LIMIT); asTextInput.value = v; }
    asTextCount.textContent = String(v.length);
  });

  function validateSubmit(){
    if(!currentTask) return false;
    if(currentTask.status==="SUBMITTED" && !currentTask.allowResubmit){
      showAsAlert("이미 제출된 과제이며 재제출이 불가합니다.");
      return false;
    }
    const type = currentTask.submitType;
    if(type==="FILE" && !asFiles.length){ showAsAlert("제출할 파일을 업로드해주세요."); return false; }
    if(type==="LINK"){
      const url = (asLinkInput.value||"").trim();
      if(!url){ showAsAlert("링크를 입력해주세요."); return false; }
      try{ new URL(url); } catch { showAsAlert("올바른 URL 형식으로 입력해주세요."); return false; }
    }
    if(type==="TEXT"){
      const t = (asTextInput.value||"").trim();
      if(!t){ showAsAlert("텍스트 내용을 입력해주세요."); return false; }
    }
    if(type==="FILE_TEXT"){
      if(!asFiles.length){ showAsAlert("제출할 파일을 업로드해주세요."); return false; }
      const t = (asTextInput.value||"").trim();
      if(!t){ showAsAlert("텍스트 내용을 입력해주세요."); return false; }
    }
    hideAsAlert();
    return true;
  }

  asBtnDraft.addEventListener("click",()=>{
    if(!currentTask) return;
    hideAsAlert();
    console.log("[임시저장]", { id: currentTask.id, link: asLinkInput.value, text: asTextInput.value, files: asFiles.map(f=>f.file.name) });
    alert("임시저장 완료(예시)");
  });

  asBtnSubmit.addEventListener("click",()=>{
    if(!currentTask) return;
    if(!validateSubmit()) return;

    console.log("[제출]", { id: currentTask.id, link: asLinkInput.value, text: asTextInput.value, files: asFiles.map(f=>f.file.name) });
    alert("제출 완료(예시)");

    // 제출 완료 처리(예시)
    TASKS = TASKS.map(t => t.id===currentTask.id ? ({...t, status:"SUBMITTED"}) : t);
    closeSubmit();
    render();
  });

  // ====== 이벤트 위임: 카드 클릭 처리(먹통 방지 핵심) ======
  taskCardList.addEventListener("click",(e)=>{
    const btn = e.target.closest("[data-action]");
    if(!btn) return;

    const action = btn.getAttribute("data-action");
    const id = btn.getAttribute("data-id");
    const task = state.list.find(x => String(x.id) === String(id));
    if(!task) return;

    if(action==="detail") openDetail(task);
    if(action==="submit") openSubmit(task);
  });

  // Filters
  tStatus.addEventListener("change",()=>{ state.status=tStatus.value; render(); });
  tKeyword.addEventListener("input",()=>{ state.keyword=tKeyword.value||""; render(); });
  tSort.addEventListener("change",()=>{ state.sort=tSort.value; render(); });
  tReset.addEventListener("click",()=>{
    tStatus.value="ALL"; tKeyword.value=""; tSort.value="DUE_SOON";
    state.status="ALL"; state.keyword=""; state.sort="DUE_SOON";
    render();
  });

  // init
  render();
</script>



		</section>
	</main>
	<footer></footer>
	
</body>
</html>
