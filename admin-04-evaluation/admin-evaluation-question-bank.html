<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="../common-style.css">
    <link rel="stylesheet" href="../sidebar-style.css">
    <link rel="stylesheet" href="../btn-style.css">
    <link rel="stylesheet" href="../pagination.css">
    <script src="../sidebar-function.js" defer></script>
    <script src="../common-funtion.js" defer></script>
    <script src="../pagination.js" defer></script>
    <title>Samsung Academy LXP - 관리자</title>
    <style>
        .filter-row {
            display: flex;
            gap: 12px;
            flex-wrap: wrap;
            align-items: center;
        }
        .filter-row > div {
            display: flex;
            align-items: center;
            gap: 6px;
        }
        .filter-row label {
            white-space: nowrap;
        }
        .filter-row input[type="text"] {
            min-width: 180px;
            flex: 1 1 0;
        }
        /* 추가적인 페이지별 스타일은 여기에 작성 */
        .question-table-area {
            width: 100%;
            display: flex;
            flex-direction: column;
            gap: 12px;
        }
        .question-table-area table {
            text-align: center;
            background: white;
            border-radius: 8px;
            border: 1px solid var(--color-line-gray);
        }

        .question-table-area thead tr {
            display: grid;
            grid-template-columns: 60px 1fr 2fr 1fr 1fr 1fr 1fr 1fr 1fr 1fr;
            gap: 16px;
            padding: 16px 20px;
            background: #f5f5f5;
            border-bottom: 2px solid var(--color-line-gray);
            font-weight: 600;
            font-size: 14px;
            color: #666;
            border-radius: 8px 8px 0 0;
        }

        .question-table-area tbody tr {
            display: grid;
            grid-template-columns: 60px 1fr 2fr 1fr 1fr 1fr 1fr 1fr 1fr 1fr;
            gap: 16px;
            padding: 20px;
            border-bottom: 1px solid var(--color-line-gray);
            align-items: center;
            transition: background 0.2s;
            cursor: pointer;
        }

        .question-table-area tbody tr:hover {
            background: #f9f9f9;
        }

        /* 모달 스타일(admin-attendance-graduate.html 참고) */
        .modal-content {
            background-color: white;
            border-radius: 12px;
            width: 90%;
            max-width: 600px;
            max-height: 85vh;
            overflow-y: auto;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.2);
        }
        .question-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }
        .question-modal.show {
            display: flex;
        }
        .modal-header {
            padding: 25px 30px 10px 30px;
            border-bottom: 1px solid var(--color-line-gray);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .modal-header h2, .modal-header h3 {
            font-size: 20px;
            font-weight: 600;
            color: var(--color-font-gray);
            margin: 0;
        }

        .modal-body {
            padding: 30px;
        }

        .history-table th {
            text-align: center;
        }
          /* 탭 스타일 */
        .tab-row {
            margin-bottom: 0;
        }
        .tab-btn {
            background: #f5f5f5;
            border: none;
            border-radius: 24px;
            padding: 12px 32px;
            font-size: 17px;
            color: #666;
            font-weight: 500;
            cursor: pointer;
            transition: background 0.2s, color 0.2s;
        }
        .tab-btn.active {
            background: var(--color-primary);
            color: #fff;
        }

        /* 유형 선택 모달 카드 스타일 */
        .type-card-list {
            display: flex;
            flex-wrap: wrap;
            gap: 18px;
            justify-content: center;
        }
        .type-card {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            width: 120px;
            height: 140px;
            background: #f8f9fa;
            border-radius: 16px;
            border: 1px solid #e0e0e0;
            cursor: pointer;
            font-size: 16px;
            font-weight: 500;
            color: #333;
            position: relative;
        }
        .type-card:hover {
            border: 1px solid var(--color-primary);
            background: #fff;
        }
        .type-card img {
            width: 48px;
            height: 48px;
            margin-bottom: 14px;
        }
    </style>
</head>
<body>
    <!-- 상단 헤더 -->
    <header class="header">
        <h1>평가 관리 > 문제 은행</h1>
        <!-- icon -->
        <div class="icon-container">
            <div class="icon-box"><img src="/icons/bell.svg" alt="alert icon" style="width: 28px;"></div>
            <div class="icon-box" onClick="location.href='../admin-00-topmenu/admin-topmenu-user.html'"><img src="/icons/user.svg" alt="user icon" style="width: 30px;"></div>
            <div class="icon-box"><img src="/icons/setting.svg" alt="setting icon" style="width: 25px;"></div>
        </div>
    </header>

    <!-- 왼쪽 사이드바 -->
    <aside class="sidebar">
        <!-- 사이드바 메뉴 내용 -->

        <!-- logo-box -->
        <div class="logo-box">
            <img id="sidebarLogo" src="/logo-white.png" alt="logo" style="width: 130px;">
        </div>

        <!-- menu -->
        <nav class="menu">
            <ul>
                <li data-page="../admin-01-dashboard/admin-dashboard.html" onclick="handleMenuClick(this, '../admin-01-dashboard/admin-dashboard.html')">
                    <img src="../icons/01-dashboard.svg" alt="dashboard icon" style="width: 26px; margin-left:-2px; margin-right: 8px; vertical-align: middle; padding-bottom: 4px;">
                    <span class="menu-text">현황(대시보드)</span>
                </li>
                <li data-page="../admin-02-user/admin-user-trainee.html" onclick="handleMenuClick(this, '../admin-02-user/admin-user-trainee.html')">
                    <img src="../icons/02-user.svg" alt="user icon" style="width: 28px; margin-right: 8px; vertical-align: middle; padding-bottom: 4px;">
                    <span class="menu-text">사용자 관리</span>
                    <ul>
                        <li class="submenu" onclick="event.stopPropagation(); location.href='../admin-02-user/admin-user-trainee.html'">훈련생 관리</li>
                        <li class="submenu" onclick="event.stopPropagation(); location.href='../admin-02-user/admin-user-instructor.html'">강사 관리</li>
                        <li class="submenu" onclick="event.stopPropagation(); location.href='../admin-02-user/admin-user.html'">관리자 관리</li>
                    </ul>
                </li>
                <li data-page="../admin-03-courses/admin-course-edu.html" onclick="handleMenuClick(this, '../admin-03-courses/admin-courses-edu.html')">
                    <img src="../icons/03-course.svg" alt="course icon" style="width: 25px; margin-right: 8px; vertical-align: middle; padding-bottom: 4px;">
                    <span class="menu-text">과정/운영 관리</span>
                    <ul>
                        <li class="submenu" onclick="event.stopPropagation(); location.href='../admin-03-courses/admin-courses-edu.html'">과정 관리</li>
                        <li class="submenu" onclick="event.stopPropagation(); location.href='../admin-03-courses/admin-courses-schedule.html'">일정 관리</li>
                    </ul>
                </li>
                <li data-page="../admin-04-evaluation/admin-evaluation-assignment.html" onclick="handleMenuClick(this, '../admin-04-evaluation/admin-evaluation-assignment.html')">
                    <img src="../icons/04-evaluation.svg" alt="evaluation icon" style="width: 30px; margin-left:-4px; margin-right: 7px; vertical-align: middle; padding-bottom: 4px;">
                    <span class="menu-text">평가 관리</span>
                    <ul>
                        <li class="submenu active_menu" onclick="event.stopPropagation(); location.href='../admin-04-evaluation/admin-evaluation-question-bank.html'">문제 은행</li>
                        <li class="submenu" onclick="event.stopPropagation(); location.href='../admin-04-evaluation/admin-evaluation-assignment.html'">과제 관리</li>
                        <li class="submenu" onclick="event.stopPropagation(); location.href='../admin-04-evaluation/admin-evaluation-test.html'">시험 관리</li>
                        <li class="submenu" onclick="event.stopPropagation(); location.href='../admin-04-evaluation/admin-evaluation-result.html'">채점 및 결과 관리</li>
                        <li class="submenu" onclick="event.stopPropagation(); location.href='../admin-04-evaluation/admin-evaluation-monitoring.html'">평가 모니터링</li>
                    </ul>
                </li>
                <li data-page="../admin-05-attendance/admin-attendance.html" onclick="handleMenuClick(this, '../admin-05-attendance/admin-attendance.html')">
                    <img src="../icons/05-attendance.svg" alt="attendance icon" style="width: 28px; margin-right: 8px; vertical-align: middle; padding-bottom: 4px;">
                    <span class="menu-text">출결/이수 관리</span>
                    <ul>
                        <li class="submenu" onclick="event.stopPropagation(); location.href='../admin-05-attendance/admin-attendance.html'">출결현황</li>
                        <li class="submenu" onclick="event.stopPropagation(); location.href='../admin-05-attendance/admin-attendance-graduate.html'">이수 관리</li>
                        <li class="submenu" onclick="event.stopPropagation(); location.href='../admin-05-attendance/admin-attendance-survey.html'">설문조사 관리</li>
                    </ul>
                </li>
                <li data-page="../admin-06-support/admin-support-tutoring.html" onclick="handleMenuClick(this, '../admin-06-support/admin-support-tutoring.html')">
                    <img src="../icons/06-support.svg" alt="support icon" style="width: 25px; margin-right: 8px; vertical-align: middle; padding-bottom: 4px;">
                    <span class="menu-text">학습 지원</span>
                    <ul>
                        <li class="submenu" onclick="event.stopPropagation(); location.href='../admin-06-support/admin-support-tutoring.html'">튜터링/QnA</li>
                        <li class="submenu" onclick="event.stopPropagation(); location.href='../admin-06-support/admin-support-response.html'">응답현황</li>
                        <li class="submenu" onclick="event.stopPropagation(); location.href='../admin-06-support/admin-support-chat-monitoring.html'">채팅 모니터링</li>
                    </ul>
                </li>
                <li data-page="../admin-07-notice/admin-notice.html" onclick="handleMenuClick(this, '../admin-07-notice/admin-notice.html')" class="white-icon">
                    <img src="../icons/bell.svg" alt="notice icon" style="width: 26px; margin-right: 8px; vertical-align: middle; padding-bottom: 4px;">
                    <span class="menu-text">공지/알림</span>
                    <ul>
                        <li class="submenu" onclick="event.stopPropagation(); location.href='../admin-07-notice/admin-notice.html'">공지 관리</li>
                        <li class="submenu" onclick="event.stopPropagation(); location.href='../admin-07-notice/admin-notice-alarm.html'">알림 관리</li>
                    </ul>
                </li>
            </ul>
        </nav>
        <span class="logout" onclick="location.href='../01-login/login.html'">로그아웃 
            <svg xmlns="http://www.w3.org/2000/svg" height="20px" viewBox="0 -960 960 960" width="20px" fill="CurrentColor">
                <path d="M186.67-120q-27 0-46.84-19.83Q120-159.67 120-186.67v-586.66q0-27 19.83-46.84Q159.67-840 186.67-840h292.66v66.67H186.67v586.66h292.66V-120H186.67Zm470.66-176.67-47-48 102-102H360v-66.66h351l-102-102 47-48 184 184-182.67 182.66Z"/>
            </svg>
        </span>
    </aside>
    </aside>

    <!-- 토글 버튼 -->
    <div class="toggle-btn" onclick="toggleSidebar()">
        ◀
    </div>

    <!-- 메인 콘텐츠 -->
    <main class="main-content">
        <!-- 훈련생 관리 -->
            <section class="main-content-inner">
                <!-- 상단: 탭 영역 -->
                <div class="tab-section" style="margin-bottom:20px;">
                    <div class="tab-row" style="display:flex; gap:8px;">
                        <button class="tab-btn active flex" data-type="전체">전체</button>
                        <button class="tab-btn flex" data-type="영상"><img src="/icons/content-video.png" alt="영상 icon" style="width:32px;vertical-align:middle;margin-right:6px;">영상</button>
                        <button class="tab-btn flex" data-type="문서"><img src="/icons/content-document.png" alt="문서 icon" style="width:32px;vertical-align:middle;margin-right:6px;">문서</button>
                        <button class="tab-btn flex" data-type="강의"><img src="/icons/content-class.png" alt="강의 icon" style="width:32px;vertical-align:middle;margin-right:6px;">강의</button>
                        <button class="tab-btn flex" data-type="문제"><img src="/icons/content-test.png" alt="문제 icon" style="width:32px;vertical-align:middle;margin-right:6px;">문제</button>
                        <button class="tab-btn flex" data-type="과제"><img src="/icons/content-practice.png" alt="과제 icon" style="width:32px;vertical-align:middle;margin-right:6px;">과제</button>
                    </div>
                </div>
                <!-- 상단: 검색/필터 영역 -->
                <div class="filter-section" style="margin-bottom:24px;">
                    <div class="filter-row">
                        <!-- 유형 -->
                        <div>
                            <label>유형</label>
                            <select class="input" name="type">
                                <option>전체</option>
                                <option>영상</option>
                                <option>문서</option>
                                <option>강의</option>
                                <option>문제</option>
                                <option>과제</option>
                            </select>
                        </div>
                        <!-- 제목(검색) -->
                        <div style="flex:1;">
                            <label>제목</label>
                            <input type="text" class="input" placeholder="콘텐츠명 검색">
                        </div>
                        <!-- 난이도 -->
                        <div>
                            <label>난이도</label>
                            <select class="input" name="difficulty">
                                <option value="전체">전체</option>
                                <option value="easy">easy</option>
                                <option value="medium">medium</option>
                                <option value="hard">hard</option>
                            </select>
                        </div>
                        <!-- 카테고리 -->
                        <div>
                            <label>카테고리</label>
                            <select class="input" name="category">
                                <option value="전체">전체</option>
                                <option value="KDT">KDT</option>
                                <option value="고교위탁">고교위탁</option>
                            </select>
                        </div>
                        <!-- 상태 -->
                        <div>
                            <label>상태</label>
                            <select class="input" name="status">
                                <option value="전체">전체</option>
                                <option value="Active">활성화</option>
                                <option value="Draft">임시저장</option>
                                <option value="Archived">비활성화</option>
                            </select>
                        </div>
                        <button class="btn btn-secondary" id="searchBtn">검색하기</button>
                        <button class="btn btn-primary" id="addBtn" style="width: 130px; height: 38px;">+ 등록하기</button>
                        <!-- 유형 선택 모달: JS로 동적 생성 -->
                    </div>
                </div>

                <div style="display:flex; justify-content:flex-end; align-items:center; gap:10px; margin-bottom:10px;">
                    <button class="btn-gray btn flex" onclick="uploadExcel()">
                        <img src="/icons/excel.svg" alt="Excel icon" style="margin-right: 8px;">
                        <span>엑셀로 등록</span>
                    </button>
                    <button class="btn-gray btn flex" onclick="uploadExcel()">
                        <svg xmlns="http://www.w3.org/2000/svg" height="20px" viewBox="0 -960 960 960" width="20px" fill="currentColor"><path d="M480-315.33 284.67-510.67l47.33-48L446.67-444v-356h66.66v356L628-558.67l47.33 48L480-315.33ZM226.67-160q-27 0-46.84-19.83Q160-199.67 160-226.67V-362h66.67v135.33h506.66V-362H800v135.33q0 27-19.83 46.84Q760.33-160 733.33-160H226.67Z"/></svg>                        
                        <span>엑셀로 다운로드</span>
                    </button>
                </div>
                <!-- 중단: 문제 리스트 (테이블) -->
                <div class="question-table-area">
                    <table style="width:100%; border-collapse:collapse;">
                        <thead>
                            <tr style="background:#f8f9fa;">
                                <th><input type="checkbox" name="select_all" id="select_all"></th>
                                <th>유형</th>
                                <th>제목</th>
                                <th>난이도</th>
                                <th>카테고리</th>
                                <th>사용중인 과정 수</th>
                                <th>평균 성취도</th>
                                <th>생성일</th>
                                <th>상태</th>
                                <th>수정하기</th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- JS로 데이터 렌더링 -->
                        </tbody>
                    </table>
                    <div class="bulk-action-area">
                        <button class="btn btn-gray btn-sm">선택 삭제</button>
                        <button class="btn btn-gray btn-sm">선택한 문제 비활성화</button>
                    </div>
                </div>

                <!-- 하단: 페이징/일괄 액션 -->
                <div class="question-bottom-area">
                    <div class="pagination">
                        <div class="page-info">
                            <span id="currentPageInfo">1</span> / <span id="totalPagesInfo">1</span> 페이지
                        </div>
                        <div class="pagination-controls">
                            <button id="prevPage" onclick="changePage(-1)" disabled>이전</button>
                            <div id="pageNumbers"></div>
                            <button id="nextPage" onclick="changePage(1)">다음</button>
                        </div>
                    </div>
                </div>
            </section>
    </main>

    <!-- 문제 상세 모달 -->
    <div id="questionModal" class="question-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="modalTitle">문제 상세</h3>
                <button class="modal-close" onclick="document.getElementById('questionModal').classList.remove('show')">
                    <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px" fill="CurrentColor"><path d="m256-200-56-56 224-224-224-224 56-56 224 224 224-224 56 56-224 224 224 224-56 56-224-224-224 224Z"/></svg>
                </button>
            </div>
            <div class="modal-body" id="modalContent">
                <!-- JS로 내용 바인딩 -->
            </div>
        </div>
    </div>
    <script>
    // 탭 클릭 이벤트 및 등록 버튼 문구 변경
    document.addEventListener('DOMContentLoaded', function() {
        // 예시: DB에서 받아온 문제 리스트
        const questionList = [
            { id: 'Q-001', type: '영상', title: '예시 영상 1', difficulty: 'easy', category: 'KDT', usedCourseCount: 3, avgAchievement: '85%', createdAt: '2024-01-01', status: 'Active', subject: '프로그래밍', topic: '웹', subtopic: 'HTML' },
            { id: 'Q-002', type: '문서', title: '예시 문서 1', difficulty: 'medium', category: '고교위탁', usedCourseCount: 1, avgAchievement: '72%', createdAt: '2024-01-10', status: 'Draft', subject: '수학', topic: '통계', subtopic: '평균' },
            { id: 'Q-003', type: '강의', title: '예시 강의 1', difficulty: 'hard', category: 'KDT', usedCourseCount: 2, avgAchievement: '90%', createdAt: '2024-01-15', status: 'Active', subject: '프로그래밍', topic: '백엔드', subtopic: 'Node.js' },
            { id: 'Q-004', type: '문제', title: '예시 퀴즈 1', difficulty: 'easy', category: '고교위탁', usedCourseCount: 4, avgAchievement: '60%', createdAt: '2024-01-20', status: 'Active', subject: '영어', topic: '문법', subtopic: '시제' },
            { id: 'Q-005', type: '과제', title: '예시 과제 1', difficulty: 'medium', category: 'KDT', usedCourseCount: 1, avgAchievement: '75%', createdAt: '2024-01-22', status: 'Draft', subject: '프로그래밍', topic: '프론트엔드', subtopic: 'React' },
            { id: 'Q-006', type: '영상', title: '예시 영상 2', difficulty: 'medium', category: 'KDT', usedCourseCount: 2, avgAchievement: '88%', createdAt: '2024-01-23', status: 'Active', subject: '수학', topic: '기하', subtopic: '삼각형' },
            { id: 'Q-007', type: '문서', title: '예시 문서 2', difficulty: 'hard', category: '고교위탁', usedCourseCount: 3, avgAchievement: '70%', createdAt: '2024-01-24', status: 'Archived', subject: '프로그래밍', topic: '알고리즘', subtopic: '정렬' },
            { id: 'Q-008', type: '강의', title: '예시 강의 2', difficulty: 'easy', category: 'KDT', usedCourseCount: 2, avgAchievement: '95%', createdAt: '2024-01-25', status: 'Active', subject: '영어', topic: '회화', subtopic: '여행' },
            { id: 'Q-009', type: '문제', title: '예시 퀴즈 2', difficulty: 'medium', category: '고교위탁', usedCourseCount: 1, avgAchievement: '65%', createdAt: '2024-01-26', status: 'Draft', subject: '수학', topic: '확률', subtopic: '주사위' },
            { id: 'Q-010', type: '과제', title: '예시 과제 2', difficulty: 'hard', category: 'KDT', usedCourseCount: 2, avgAchievement: '80%', createdAt: '2024-01-27', status: 'Active', subject: '프로그래밍', topic: '데이터', subtopic: 'SQL' }
        ];
        // window._questionList를 항상 초기화
        window._questionList = questionList;
        // 탭 버튼 눌렀을때 필터링
        // 전역 변수에 저장 (탭/필터링용)
        const tabBtns = document.querySelectorAll('.tab-btn');
        const addBtn = document.getElementById('addBtn');
        let typeSelectModal = null;
                // addBtn 클릭 시 동작: 전체면 모달(동적 생성), 탭별이면 해당 등록 페이지 이동
                if (addBtn) {
                    addBtn.addEventListener('click', function() {
                        const activeTab = document.querySelector('.tab-btn.active');
                        const type = activeTab ? activeTab.dataset.type : '전체';
                        if (type === '전체') {
                            // 유형 선택 모달 동적 생성
                            if (typeSelectModal) return; // 이미 열려있으면 중복생성 방지
                            typeSelectModal = document.createElement('div');
                            typeSelectModal.id = 'typeSelectModal';
                            typeSelectModal.className = 'question-modal show';
                            typeSelectModal.innerHTML = `
                                <div class="modal-content" style="max-width:520px;">
                                    <div class="modal-header">
                                        <h3 style="font-size:18px;">추가할 콘텐츠 유형 선택</h3>
                                        <button class="modal-close" id="closeTypeSelectModalBtn">
                                            <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px" fill="CurrentColor"><path d="m256-200-56-56 224-224-224-224 56-56 224 224 224-224 56 56-224 224 224 224-56 56-224-224-224 224Z"/></svg>
                                        </button>
                                    </div>
                                    <div class="modal-body" style="padding:32px 24px;">
                                        <div class="type-card-list">
                                            <div class="type-card" data-type="영상">
                                                <img src="/icons/content-video.png" alt="영상 아이콘">
                                                <span>영상 등록</span>
                                            </div>
                                            <div class="type-card" data-type="문서">
                                                <img src="/icons/content-document.png" alt="문서 아이콘">
                                                <span>문서 등록</span>
                                            </div>
                                            <div class="type-card" data-type="강의">
                                                <img src="/icons/content-class.png" alt="강의 아이콘">
                                                <span>강의 등록</span>
                                            </div>
                                            <div class="type-card" data-type="문제">
                                                <img src="/icons/content-test.png" alt="문제 아이콘">
                                                <span>문제 등록</span>
                                            </div>
                                            <div class="type-card" data-type="과제">
                                                <img src="/icons/content-practice.png" alt="과제 아이콘">
                                                <span>과제 등록</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            `;
                            document.body.appendChild(typeSelectModal);
                            // 카드 클릭 이벤트
                            typeSelectModal.querySelectorAll('.type-card').forEach(card => {
                                card.addEventListener('click', function() {
                                    const type = card.getAttribute('data-type');
                                    let page = '';
                                    switch(type) {
                                        case '영상': page = 'add-video.html'; break;
                                        case '문서': page = 'add-document.html'; break;
                                        case '강의': page = 'add-class.html'; break;
                                        case '문제': page = 'add-test.html'; break;
                                        case '과제': page = 'add-practice.html'; break;
                                        default: page = 'add-video.html'; break;
                                    }
                                    document.body.removeChild(typeSelectModal);
                                    typeSelectModal = null;
                                    window.location.href = page;
                                });
                            });
                            // 닫기 버튼
                            typeSelectModal.querySelector('#closeTypeSelectModalBtn').addEventListener('click', function(e) {
                                document.body.removeChild(typeSelectModal);
                                typeSelectModal = null;
                            });
                            // 모달 바깥 클릭 시 닫기
                            typeSelectModal.addEventListener('click', function(e) {
                                if (e.target === typeSelectModal) {
                                    document.body.removeChild(typeSelectModal);
                                    typeSelectModal = null;
                                }
                            });
                        } else {
                            // 각 유형별 등록 페이지로 이동
                            let page = '';
                            switch(type) {
                                case '영상': page = 'add-video.html'; break;
                                case '문서': page = 'add-document.html'; break;
                                case '강의': page = 'add-class.html'; break;
                                case '문제': page = 'add-test.html'; break;
                                case '과제': page = 'add-practice.html'; break;
                                default: page = 'add-video.html'; break;
                            }
                            window.location.href = page;
                        }
                    });
                }

                // 기존 typeSelectModal 관련 코드 제거 (동적 생성/제거로 대체)
        const tabTextMap = {
            '전체': '등록하기',
            '영상': '영상 등록',
            '문서': '문서 등록',
            '강의': '강의 등록',
            '퀴즈': '퀴즈 등록',
            '과제': '과제 등록'
        };
        
        // 탭 클릭 시 필터링 (window._questionList 기준으로 항상 테이블 갱신)
        tabBtns.forEach(btn => {
            btn.addEventListener('click', function() {
                tabBtns.forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                // 등록 버튼 문구 변경
                if (addBtn) {
                    addBtn.innerHTML = '+ ' + (tabTextMap[btn.dataset.type] || '문제 등록');
                }
                // 탭 필터링 동작
                const type = btn.dataset.type;
                // 필터 select의 유형도 동기화
                if (filterType) {
                    filterType.value = type;
                }
                let filtered = [];
                if (questionList) {
                    if (type === '전체') {
                        filtered = questionList;
                    } else {
                        filtered = questionList.filter(q => q.type === type);
                    }
                    renderTable(filtered);
                }
            });
        });
        // 페이지 로드 시 기본값
        if (addBtn) {
            addBtn.innerHTML = '+ 등록하기';
        }

        // 필터 섹션 동작 구현
        const filterSection = document.querySelector('.filter-section');
        const filterType = filterSection.querySelector('select[name="type"]');
        const filterTitle = filterSection.querySelector('input[type="text"]');
        const filterDifficulty = filterSection.querySelector('select[name="difficulty"]');
        const filterCategory = filterSection.querySelector('select[name="category"]');
        const filterStatus = filterSection.querySelector('select[name="status"]');
        const filterBtn = document.getElementById('searchBtn');

        function applyFilters() {
            let filtered = questionList;
            // 각 필터 요소가 null이 아니면 value 사용, 아니면 '전체' 기본값
            const typeVal = filterType && filterType.value ? filterType.value : '전체';
            const titleVal = filterTitle && filterTitle.value ? filterTitle.value.trim().toLowerCase() : '';
            const diffVal = filterDifficulty && filterDifficulty.value ? filterDifficulty.value : '전체';
            const catVal = filterCategory && filterCategory.value ? filterCategory.value : '전체';
            const statusVal = filterStatus && filterStatus.value ? filterStatus.value : '전체';

            filtered = filtered.filter(q => {
                // 유형
                if (typeVal !== '전체' && q.type !== typeVal) return false;
                // 제목 (부분일치, 대소문자 무시)
                if (titleVal && (!q.title || !q.title.toLowerCase().includes(titleVal))) return false;
                // 난이도
                if (diffVal !== '전체' && q.difficulty !== diffVal) return false;
                // 카테고리
                if (catVal !== '전체' && q.category !== catVal) return false;
                // 상태
                if (statusVal !== '전체' && q.status !== statusVal) return false;
                return true;
            });

            // 탭 active와 유형 select 동기화
            tabBtns.forEach(b => {
                if (b.dataset.type === typeVal) {
                    b.classList.add('active');
                } else if (typeVal === '전체' && b.dataset.type === '전체') {
                    b.classList.add('active');
                } else {
                    b.classList.remove('active');
                }
            });
            renderTable(filtered);
        }

        if (filterBtn) {
            filterBtn.addEventListener('click', applyFilters);
        }
        filterTitle.addEventListener('keydown', function(e) {
            if (e.key === 'Enter') applyFilters();
        });

        // 테이블 바인딩 함수
        function renderTable(data) {
            const tbody = document.querySelector('.question-table-area tbody');
            tbody.innerHTML = '';
            // data가 undefined/null이면 빈 배열로 처리
            if (!Array.isArray(data)) data = [];
            // 유형별 아이콘 매핑
            const typeIconMap = {
                '영상': 'content-video.png',
                '문서': 'content-document.png',
                '강의': 'content-class.png',
                '문제': 'content-test.png',
                '과제': 'content-practice.png'
            };
            data.forEach(q => {
                const tr = document.createElement('tr');
                const iconFile = typeIconMap[q.type] || 'content-etc.png';
                // 상태 뱃지 분기
                let statusClass = '';
                let statusText = '';
                if (q.status === 'Active') {
                    statusClass = 'status-in-progress';
                    statusText = '활성화';
                } else if (q.status === 'Draft') {
                    statusClass = 'status-completed';
                    statusText = '임시저장';
                } else if (q.status === 'Archived') {
                    statusClass = 'status-disabled';
                    statusText = '비활성화';
                } else {
                    statusClass = '';
                    statusText = q.status;
                }
                tr.innerHTML = `
                    <td style="text-align:center;"><input type="checkbox"></td>
                    <td style="color:#999;"><img src="/icons/${iconFile}" alt="${q.type}" style="width:36px;vertical-align:middle;margin-right:6px;">${q.type}</td>
                    <td>${q.title}</td>
                    <td>${q.difficulty}</td>
                    <td>${q.category}</td>
                    <td>${q.usedCourseCount}</td>
                    <td>${q.avgAchievement}</td>
                    <td>${q.createdAt}</td>
                    <td><span class="status-badge ${statusClass}">${statusText}</span></td>
                    <td><button class="btn btn-secondary btn-sm" data-id="${q.id}">수정하기</button></td>
                `;
                tbody.appendChild(tr);
            });
        }
        // 최초 로드 시 전체 데이터로 테이블 렌더링
        renderTable(window._questionList);

        // 전체선택 체크박스 기능
        const selectAll = document.getElementById('select_all');
        const tbody = document.querySelector('.question-table-area tbody');
        selectAll.addEventListener('change', function() {
            const checkboxes = tbody.querySelectorAll('input[type="checkbox"]');
            checkboxes.forEach(cb => {
                cb.checked = selectAll.checked;
            });
        });
        tbody.addEventListener('change', function(e) {
            if (e.target.type === 'checkbox') {
                const checkboxes = Array.from(tbody.querySelectorAll('input[type="checkbox"]'));
                selectAll.checked = checkboxes.every(cb => cb.checked);
            }
        });
        
        // 수정 버튼 클릭 시 update 페이지로 이동
        // 유형에 따라 수정 페이지 경로 반환 함수
        function getUpdatePageByType(type) {
            switch(type) {
                case '영상': return 'update-video.html';
                case '문서': return 'update-document.html';
                case '강의': return 'update-class.html';
                case '문제': return 'update-test.html';
                case '과제': return 'update-practice.html';
                default: return 'admin-evaluation-question-bank.html';
            }
        }


        // tr 클릭 시 모달로 상세 보기 (수정 버튼 제외)
        const modal = document.getElementById('questionModal');
        const modalContent = document.getElementById('modalContent');
        const closeModalBtn = document.getElementById('closeModalBtn');
        tbody.addEventListener('click', function(e) {
            if (e.target.classList.contains('btn-secondary')) {
                // 수정하기 버튼 클릭 시 모달 열리지 않도록 이벤트 중단
                e.stopPropagation();
                const qid = e.target.getAttribute('data-id');
                let tr = e.target.closest('tr');
                let type = '';
                if (tr) {
                    const typeTd = tr.querySelectorAll('td')[1];
                    if (typeTd) {
                        type = typeTd.textContent.trim();
                    }
                }
                const page = getUpdatePageByType(type);
                window.location.href = `${page}?id=${encodeURIComponent(qid)}`;
                return;
            }
            let tr = e.target.closest('tr');
            if (!tr) return;
            const trs = Array.from(tbody.querySelectorAll('tr'));
            const idx = trs.indexOf(tr);
            if (idx < 0) return;
            // window._questionList에서 원본 데이터 사용
            const q = window._questionList.find(item => item.id === tr.querySelector('button.btn-secondary').getAttribute('data-id'));
            if (!q) return;
            let html = '';
                html += `<table class="history-table" style="width:100%; border-collapse:collapse; border:1px solid var(--color-line-gray);">`;
                html += `<tr><th style='width:120px;'>유형</th><td>${q.type}</td><th>상태</th><td>${q.status}</td></tr>`;
                html += `<tr><th>제목</th><td colspan="3">${q.title}</td></tr>`;
                html += `<tr><th>난이도</th><td>${q.difficulty}</td><th>카테고리</th><td>${q.category}</td></tr>`;
                html += `<tr><th>사용중인 과정 수</th><td>${q.usedCourseCount}</td><th>평균 성취도</th><td>${q.avgAchievement}</td></tr>`;
                html += `<tr><th>생성일</th><td>${q.createdAt}</td><th>소요시간</th><td>${q.duration || '정보 없음'}</td></tr>`;
                html += `<tr><th>문제분류</th><td colspan="3">${q.subject || ''}${q.subject && q.topic ? ' > ' : ''}${q.topic || ''}${q.topic && q.subtopic ? ' > ' : ''}${q.subtopic || ''}</td></tr>`;
                html += `</table>`;
            // 미리보기 영역 및 상세내용 추가 (영상/문서)
            if (q.type === '영상') {
                if (q.previewUrl) {
                    html += `<div style='margin:24px 0; text-align:center;'>
                        <video src='${q.previewUrl}' controls style='max-width:100%; height:240px; border-radius:8px; background:#000;'></video>
                        <div style='margin-top:8px; color:#888;'>영상 미리보기</div>
                    </div>`;
                }
                // 영상 상세내용
                html += `<div style='margin:24px 0;'>
                    <div style='margin-bottom:18px;'>
                        <h4 style='font-size:16px; color:#333; margin-bottom:8px;'>영상 설명</h4>
                        <div style='background:#f8f9fa; padding:12px 16px; border-radius:8px; color:#555;'>${q.description || '영상 설명이 없습니다.'}</div>
                    </div>
                    <div style='margin-bottom:18px;'>
                        <h4 style='font-size:16px; color:#333; margin-bottom:8px;'>영상 길이</h4>
                        <div style='background:#f8f9fa; padding:12px 16px; border-radius:8px; color:#555;'>${q.duration || '정보 없음'}</div>
                    </div>
                    <div>
                        <h4 style='font-size:16px; color:#333; margin-bottom:8px;'>영상 자료</h4>
                        <div style='background:#f8f9fa; padding:12px 16px; border-radius:8px; color:#555;'>${q.materials || '미리보기'}</div>
                            ${q.materialsPreviewUrl ? `
                            <div style='margin-top:16px; text-align:center;'>
                                ${q.materialsPreviewUrl.endsWith('.mp4') ? `<video src='${q.materialsPreviewUrl}' controls style='max-width:100%; height:180px; border-radius:8px; background:#000;'></video>` : ''}
                                ${(q.materialsPreviewUrl.endsWith('.jpg') || q.materialsPreviewUrl.endsWith('.png') || q.materialsPreviewUrl.endsWith('.jpeg')) ? `<img src='${q.materialsPreviewUrl}' alt='자료 미리보기' style='max-width:100%; height:180px; object-fit:contain; border-radius:8px; border:1px solid #eee;'>` : ''}
                                ${q.materialsPreviewUrl.endsWith('.pdf') ? `<iframe src='${q.materialsPreviewUrl}' style='width:100%; height:180px; border-radius:8px; border:1px solid #eee;'></iframe>` : ''}
                                <div style='margin-top:8px; color:#888;'>자료 미리보기</div>
                            </div>
                            ` : ''}
                    </div>
                </div>`;
            } else if (q.type === '문서') {
                if (q.previewUrl) {
                    // 이미지 또는 PDF 미리보기
                    if (q.previewUrl.endsWith('.pdf')) {
                        html += `<div style='margin:24px 0; text-align:center;'>
                            <iframe src='${q.previewUrl}' style='width:100%; height:320px; border-radius:8px; border:1px solid #eee;'></iframe>
                            <div style='margin-top:8px; color:#888;'>문서 미리보기 (PDF)</div>
                        </div>`;
                    } else {
                        html += `<div style='margin:24px 0; text-align:center;'>
                            <img src='${q.previewUrl}' alt='문서 미리보기' style='max-width:100%; height:320px; object-fit:contain; border-radius:8px; border:1px solid #eee;'>
                            <div style='margin-top:8px; color:#888;'>문서 미리보기</div>
                        </div>`;
                    }
                }
                // 문서 상세내용
                html += `<div style='margin:24px 0;'>
                    <div style='margin-bottom:18px;'>
                        <h4 style='font-size:16px; color:#333; margin-bottom:8px;'>문서 설명</h4>
                        <div style='background:#f8f9fa; padding:12px 16px; border-radius:8px; color:#555;'>${q.description || '문서 설명이 없습니다.'}</div>
                    </div>
                    <div style='margin-bottom:18px;'>
                        <h4 style='font-size:16px; color:#333; margin-bottom:8px;'>문서 유형</h4>
                        <div style='background:#f8f9fa; padding:12px 16px; border-radius:8px; color:#555;'>${q.documentType || '문서 유형 정보 없음'}</div>
                    </div>
                    <div>
                        <h4 style='font-size:16px; color:#333; margin-bottom:8px;'>문서 자료</h4>
                        <div style='background:#f8f9fa; padding:12px 16px; border-radius:8px; color:#555;'>${q.materials || '미리보기'}</div>
                            ${q.materialsPreviewUrl ? `
                            <div style='margin-top:16px; text-align:center;'>
                                ${(q.materialsPreviewUrl.endsWith('.jpg') || q.materialsPreviewUrl.endsWith('.png') || q.materialsPreviewUrl.endsWith('.jpeg')) ? `<img src='${q.materialsPreviewUrl}' alt='자료 미리보기' style='max-width:100%; height:180px; object-fit:contain; border-radius:8px; border:1px solid #eee;'>` : ''}
                                ${q.materialsPreviewUrl.endsWith('.pdf') ? `<iframe src='${q.materialsPreviewUrl}' style='width:100%; height:180px; border-radius:8px; border:1px solid #eee;'></iframe>` : ''}
                                ${q.materialsPreviewUrl.endsWith('.mp4') ? `<video src='${q.materialsPreviewUrl}' controls style='max-width:100%; height:180px; border-radius:8px; background:#000;'></video>` : ''}
                                <div style='margin-top:8px; color:#888;'>자료 미리보기</div>
                            </div>
                            ` : ''}
                    </div>
                </div>`;
            } else if (q.type === '강의') {
                // 강의 상세: 수업개요, 학습자료, 진행안내(설명)
                html += `<div style='margin:24px 0;'>
                    <div style='margin-bottom:18px;'>
                        <h4 style='font-size:16px; color:#333; margin-bottom:8px;'>수업개요</h4>
                        <div style='background:#f8f9fa; padding:12px 16px; border-radius:8px; color:#555;'>${q.overview || '수업개요 정보가 없습니다.'}</div>
                    </div>
                    <div style='margin-bottom:18px;'>
                        <h4 style='font-size:16px; color:#333; margin-bottom:8px;'>학습자료</h4>
                        <div style='background:#f8f9fa; padding:12px 16px; border-radius:8px; color:#555;'>${q.materials || '학습자료 정보가 없습니다.'}</div>
                    </div>
                    <div>
                        <h4 style='font-size:16px; color:#333; margin-bottom:8px;'>진행안내(설명)</h4>
                        <div style='background:#f8f9fa; padding:12px 16px; border-radius:8px; color:#555;'>${q.guide || '진행안내 정보가 없습니다.'}</div>
                    </div>
                </div>`;
            } else if (q.type === '과제') {
                // 문제 상세: 주관식/객관식, 문제 설명, 답, 해설
                html += `<div style='margin:24px 0;'>
                    <div style='margin-bottom:18px;'>
                        <h4 style='font-size:16px; color:#333; margin-bottom:8px;'>과제 유형</h4>
                        <div style='background:#f8f9fa; padding:12px 16px; border-radius:8px; color:#555;'>${q.questionType || '정보 없음'}</div>
                    </div>
                    <div style='margin-bottom:18px;'>
                        <h4 style='font-size:16px; color:#333; margin-bottom:8px;'>과제 설명</h4>
                        <div style='background:#f8f9fa; padding:12px 16px; border-radius:8px; color:#555;'>${q.description || '과제 설명이 없습니다.'}</div>
                    </div>
                    <div style='margin-bottom:18px;'>
                        <h4 style='font-size:16px; color:#333; margin-bottom:8px;'>정답</h4>
                        <div style='background:#f8f9fa; padding:12px 16px; border-radius:8px; color:#555;'>${q.answer || '정답 정보가 없습니다.'}</div>
                    </div>
                    <div>
                        <h4 style='font-size:16px; color:#333; margin-bottom:8px;'>해설</h4>
                        <div style='background:#f8f9fa; padding:12px 16px; border-radius:8px; color:#555;'>${q.explanation || '해설 정보가 없습니다.'}</div>
                    </div>
                </div>`;
            } else if ( q.type === '문제') {
                // 문제 상세: 주관식/객관식, 문제 설명, 답, 해설
                html += `<div style='margin:24px 0;'>
                    <div style='margin-bottom:18px;'>
                        <h4 style='font-size:16px; color:#333; margin-bottom:8px;'>문제 유형</h4>
                        <div style='background:#f8f9fa; padding:12px 16px; border-radius:8px; color:#555;'>${q.questionType || '정보 없음'}</div>
                    </div>
                    <div style='margin-bottom:18px;'>
                        <h4 style='font-size:16px; color:#333; margin-bottom:8px;'>문제 설명</h4>
                        <div style='background:#f8f9fa; padding:12px 16px; border-radius:8px; color:#555;'>${q.description || '문제 설명이 없습니다.'}</div>
                    </div>
                    <div style='margin-bottom:18px;'>
                        <h4 style='font-size:16px; color:#333; margin-bottom:8px;'>정답</h4>
                        <div style='background:#f8f9fa; padding:12px 16px; border-radius:8px; color:#555;'>${q.answer || '정답 정보가 없습니다.'}</div>
                    </div>
                    <div>
                        <h4 style='font-size:16px; color:#333; margin-bottom:8px;'>해설</h4>
                        <div style='background:#f8f9fa; padding:12px 16px; border-radius:8px; color:#555;'>${q.explanation || '해설 정보가 없습니다.'}</div>
                    </div>
                </div>`;
            }
            html += `<button style="margin-top: 16px; margin-left: auto; display: block;" class="btn btn-secondary" onclick="window.location.href='admin-evaluation-question-bank-update.html?id=${encodeURIComponent(q.id)}'">수정하기</button>`;
            modal.classList.add('show');
            modalContent.innerHTML = html;
            // 모달 제목 동적 변경
            const modalTitle = document.getElementById('modalTitle');
            if (modalTitle) {
                let titleText = '문제 상세';
                if (q.type === '영상') titleText = '영상 상세';
                else if (q.type === '문서') titleText = '문서 상세';
                else if (q.type === '강의') titleText = '강의 상세';
                else if (q.type === '과제') titleText = '과제 상세';
                modalTitle.textContent = titleText;
            }
        });
        if (closeModalBtn) {
            closeModalBtn.addEventListener('click', function() {
                modal.classList.remove('show');
            });
        }
        modal.addEventListener('click', function(e) {
            // 모달 바깥 영역 클릭 시 닫기 (modal-content 이외 클릭)
            if (e.target === modal || e.target.classList.contains('question-modal')) {
                modal.classList.remove('show');
            }
        });
    });
    </script>
</body>
</html>