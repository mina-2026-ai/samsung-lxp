<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="../common-style.css">
    <link rel="stylesheet" href="../sidebar-style.css">
    <link rel="stylesheet" href="../btn-style.css">
    
    <script src="../sidebar-function.js" defer></script>
    <script src="../common-funtion.js" defer></script>
    <title>Samsung Academy LXP - 관리자</title>
    <style>
         /* Layout */
        .page{min-height:100vh;background:#f6f7fb;color:#222;font-family:system-ui,-apple-system,Segoe UI,Roboto,Apple SD Gothic Neo,Noto Sans KR,sans-serif;}
        .topbar{padding:18px 20px;border-bottom:1px solid #e8e8ee;background:#fff;position:sticky;top:0;z-index:10;}
        .page-title{margin:0;font-size:20px;}
        .page-subtitle{margin:6px 0 0;color:#666;font-size:13px;}

        .content{
            padding:18px 20px 90px;
            display:grid;
            grid-template-columns: 360px 1fr;
            gap:16px;
            align-items:start;
        }
        .panel{background:#fff;border:1px solid #e8e8ee;border-radius:14px;overflow:hidden;box-shadow:0 4px 18px rgba(0,0,0,0.04);}
        .panel-head{display:flex;align-items:baseline;gap:10px;padding:14px 16px;border-bottom:1px solid #f0f0f4;background:#fafafa;}
        .panel-title{margin:0;font-size:15px;}
        .panel-desc{color:#888;font-size:12px;}

        /* Form */
        .form{padding:14px 16px;display:flex;flex-direction:column;gap:14px;}
        .field{display:flex;flex-direction:column;gap:8px;}
        .label{font-size:12px;color:#555;font-weight:700;}
        .req{color:#d92d20;margin-left:2px;}
        .input,.select,.textarea{
            border:1px solid #dcdce6;border-radius:10px;padding:10px 12px;font-size:13px;background:#fff;box-sizing:border-box;
        }
        .hint{margin:0;color:#888;font-size:12px;line-height:1.4;}
        .radio-group{display:flex;gap:12px;flex-wrap:wrap;}
        .radio{font-size:13px;color:#333;display:flex;align-items:center;gap:6px;}
        .readonly{display:flex;align-items:center;gap:8px;}

        .badge{display:inline-flex;align-items:center;padding:4px 10px;border-radius:999px;font-size:12px;font-weight:700;}
        .badge-planned{background:#eef3ff;color:#2a57ff;}

        /* Questions */
        .questions{padding:14px 16px;display:flex;flex-direction:column;gap:12px;}
        .q-card{border:1px solid #ececf2;border-radius:12px;overflow:hidden;background:#fff;}
        .q-top{display:flex;justify-content:space-between;gap:10px;padding:12px 12px;border-bottom:1px solid #f2f2f7;background:#fbfbfd;}
        .q-title{font-size:13px;line-height:1.4;}
        .q-actions{display:flex;gap:8px;align-items:center;white-space:nowrap;}
        .q-meta{padding:10px 12px;}
        .pill{display:inline-flex;padding:4px 10px;border-radius:999px;background:#f1f2f6;color:#333;font-size:12px;}
        .q-preview{padding:12px;}
        .scale{display:flex;align-items:center;gap:10px;flex-wrap:wrap;}
        .scale-label{color:#666;font-size:12px;}
        .scale-nums{display:flex;gap:8px;}
        .scale-num{display:inline-flex;align-items:center;justify-content:center;width:30px;height:30px;border-radius:10px;border:1px solid #e1e1ea;background:#fff;font-size:12px;color:#333;}
        .add-question{
            border:1px dashed #cfd2df;background:#fff;border-radius:12px;padding:12px;cursor:pointer;
            font-weight:700;color:#2a57ff;
        }
        .add-question:hover{background:#f6f8ff;}

        /* Action bar */
        .actionbar{
            position:sticky;bottom:0;z-index:20;
            display:flex;justify-content:space-between;align-items:center;
            padding:12px 20px;background:#fff;border-top:1px solid #e8e8ee;
        }
        .actionbar-right{display:flex;gap:10px;}

        /* Buttons */
        .btn{
            border:1px solid #dcdce6;background:#fff;color:#222;
            padding:10px 12px;border-radius:12px;cursor:pointer;font-size:13px;
        }
        .btn:hover{background:#fafafa;}
        .btn-ghost{background:#fafafa;}
        .btn-ghost:hover{background:#f2f2f7;}
        .btn-primary{background:#2a57ff;border-color:#2a57ff;color:#fff;}
        .btn-primary:hover{filter:brightness(0.95);}
        .danger{color:#d92d20;}

        /* Modal */
        .modal-backdrop{
            position:fixed;inset:0;background:rgba(0,0,0,0.45);
            display:flex;align-items:center;justify-content:center;padding:20px;z-index:9999;
        }
        .modal{
            width:min(680px,96vw);background:#fff;border-radius:14px;overflow:hidden;
            box-shadow:0 18px 70px rgba(0,0,0,0.28);border:1px solid rgba(255,255,255,0.2);
        }
        [hidden] {
            display: none !important;
        }
        .modal-head{display:flex;justify-content:space-between;align-items:center;padding:14px 16px;border-bottom:1px solid #eee;background:#fff;}
        .modal-title{margin:0;font-size:15px;}
        .icon-btn{border:0;background:transparent;font-size:18px;cursor:pointer;}
        .modal-body{padding:14px 16px;display:flex;flex-direction:column;gap:14px;}
        .modal-foot{display:flex;justify-content:flex-end;gap:10px;padding:12px 16px;border-top:1px solid #eee;background:#fff;}

        .choice-list{display:flex;flex-direction:column;gap:10px;}
        .choice-row{display:grid;grid-template-columns:1fr auto;gap:10px;align-items:center;}
    </style>
</head>
<body>
    <!-- 상단 헤더 -->
    <header class="header">
        <h1>출결/이수 관리 > 설문조사 관리 > 설문조사 추가</h1>
        <!-- icon -->
        <div class="icon-container">
            <div class="icon-box"><img src="/icons/bell.svg" alt="alert icon" style="width: 28px;"></div>
            <div class="icon-box" onClick="location.href='../admin-00-topmenu/admin-topmenu-user.html'"><img src="/icons/user.svg" alt="user icon" style="width: 30px;"></div>
            <div class="icon-box"><img src="/icons/setting.svg" alt="setting icon" style="width: 25px;"></div>
        </div>
    </header>

    <!-- 왼쪽 사이드바 -->
    <aside class="sidebar">
        <!-- 사이드바 메뉴 내용 -->

        <!-- logo-box -->
        <div class="logo-box">
            <img id="sidebarLogo" src="/logo-white.png" alt="logo" style="width: 130px;">
        </div>

        <!-- menu -->
        <nav class="menu">
            <ul>
                <li data-page="../admin-01-dashboard/admin-dashboard.html" onclick="handleMenuClick(this, '../admin-01-dashboard/admin-dashboard.html')">
                    <img src="../icons/01-dashboard.svg" alt="dashboard icon" style="width: 26px; margin-left:-2px; margin-right: 8px; vertical-align: middle; padding-bottom: 4px;">
                    <span class="menu-text">현황(대시보드)</span>
                </li>
                <li data-page="../admin-02-user/admin-user-trainee.html" onclick="handleMenuClick(this, '../admin-02-user/admin-user-trainee.html')" >
                    <img src="../icons/02-user.svg" alt="user icon" style="width: 28px; margin-right: 8px; vertical-align: middle; padding-bottom: 4px;">
                    <span class="menu-text">사용자 관리</span>
                    <ul>
                        <li class="submenu" onclick="event.stopPropagation(); location.href='../admin-02-user/admin-user-trainee.html'">훈련생 관리</li>
                        <li class="submenu" onclick="event.stopPropagation(); location.href='../admin-02-user/admin-user-instructor.html'">강사 관리</li>
                        <li class="submenu" onclick="event.stopPropagation(); location.href='../admin-02-user/admin-user.html'">관리자 관리</li>
                    </ul>
                </li>
                <li data-page="../admin-04-evaluation/admin-evaluation-question-bank.html" onclick="handleMenuClick(this, '../admin-04-evaluation/admin-evaluation-question-bank.html')">
                    <img src="../icons/03-description.svg" alt="evaluation icon" style="width: 26px; margin-left:0px; margin-right: 7px; vertical-align: middle; padding-bottom: 4px;">
                    <span class="menu-text">콘텐츠 관리</span>
                </li>
                <li data-page="../admin-03-courses/admin-course-edu.html" onclick="handleMenuClick(this, '../admin-03-courses/admin-courses-edu.html')">
                    <img src="../icons/03-course.svg" alt="course icon" style="width: 25px; margin-right: 8px; vertical-align: middle; padding-bottom: 4px;">
                    <span class="menu-text">과정/운영 관리</span>
                    <ul>
                        <li class="submenu" onclick="event.stopPropagation(); location.href='../admin-03-courses/admin-courses-edu.html'">과정 관리</li>
                        <li class="submenu" onclick="event.stopPropagation(); location.href='../admin-03-courses/admin-courses-schedule.html'">일정 관리</li>
                    </ul>
                </li>
                <li data-page="../admin-04-evaluation/admin-evaluation-assignment.html" onclick="handleMenuClick(this, '../admin-04-evaluation/admin-evaluation-assignment.html')">
                    <img src="../icons/04-evaluation.svg" alt="evaluation icon" style="width: 30px; margin-left:-4px; margin-right: 7px; vertical-align: middle; padding-bottom: 4px;">
                    <span class="menu-text active_menu">평가 관리</span>
                    <ul>
                        <li class="submenu active_menu" onclick="event.stopPropagation(); location.href='../admin-04-evaluation/admin-evaluation-assignment.html'">과제 채점</li>

                                                
                        <li class="submenu" onclick="event.stopPropagation(); location.href='../admin-04-evaluation/admin-evaluation-result.html'">시험 채점</li>
                        <li class="submenu" onclick="event.stopPropagation(); location.href='../admin-04-evaluation/admin-evaluation-monitoring.html'">평가 모니터링</li>
                    </ul>
                </li>
                <li data-page="../admin-05-attendance/admin-attendance.html" onclick="handleMenuClick(this, '../admin-05-attendance/admin-attendance.html')">
                    <img src="../icons/05-attendance.svg" alt="attendance icon" style="width: 28px; margin-right: 8px; vertical-align: middle; padding-bottom: 4px;">
                    <span class="menu-text active_menu">출결/이수 관리</span>
                    <ul>
                        <li class="submenu" onclick="event.stopPropagation(); location.href='../admin-05-attendance/admin-attendance.html'">출결현황</li>
                        <li class="submenu" onclick="event.stopPropagation(); location.href='../admin-05-attendance/admin-attendance-graduate.html'">이수 관리</li>
                        <li class="submenu active_menu" onclick="event.stopPropagation(); location.href='../admin-05-attendance/admin-attendance-survey.html'">설문조사 관리</li>
                    </ul>
                </li>
                <li data-page="../admin-06-support/admin-support-tutoring.html" onclick="handleMenuClick(this, '../admin-06-support/admin-support-tutoring.html')">
                    <img src="../icons/06-support.svg" alt="support icon" style="width: 25px; margin-right: 8px; vertical-align: middle; padding-bottom: 4px;">
                    <span class="menu-text">학습 지원</span>
                    <ul>
                        <li class="submenu" onclick="event.stopPropagation(); location.href='../admin-06-support/admin-support-tutoring.html'">튜터링/Q&A</li>
                        <li class="submenu" onclick="event.stopPropagation(); location.href='../admin-06-support/admin-support-response.html'">응답현황</li>
                        <li class="submenu" onclick="event.stopPropagation(); location.href='../admin-06-support/admin-support-chat-monitoring.html'">채팅 모니터링</li>
                    </ul>
                </li>
                <li data-page="../admin-07-notice/admin-notice.html" onclick="handleMenuClick(this, '../admin-07-notice/admin-notice.html')" class="white-icon">
                    <img src="../icons/bell.svg" alt="notice icon" style="width: 26px; margin-right: 8px; vertical-align: middle; padding-bottom: 4px;">
                    <span class="menu-text">공지/알림</span>
                    <ul>
                        <li class="submenu" onclick="event.stopPropagation(); location.href='../admin-07-notice/admin-notice.html'">공지 관리</li>
                        <li class="submenu" onclick="event.stopPropagation(); location.href='../admin-07-notice/admin-alarm.html'">알림 관리</li>
                    </ul>
                </li>
            </ul>
        </nav>
                <span class="logout" onclick="location.href='../01-login/login.html'">로그아웃 

            <svg xmlns="http://www.w3.org/2000/svg" height="20px" viewBox="0 -960 960 960" width="20px" fill="CurrentColor">
                <path d="M186.67-120q-27 0-46.84-19.83Q120-159.67 120-186.67v-586.66q0-27 19.83-46.84Q159.67-840 186.67-840h292.66v66.67H186.67v586.66h292.66V-120H186.67Zm470.66-176.67-47-48 102-102H360v-66.66h351l-102-102 47-48 184 184-182.67 182.66Z"/>
            </svg>
        </span>
    </aside>

    <!-- 토글 버튼 -->
    <div class="toggle-btn" onclick="toggleSidebar()">
        ◀
    </div>

    
    <!-- 메인 콘텐츠 -->
    <main class="main-content">
        <section class="main-content-inner">
            <div id="selectedCourseInfo"></div>
                    
            <!-- LEFT: 설문 설정 -->
            <section class="panel panel-left" aria-label="설문 설정">
            <div class="panel-head">
                <h2 class="panel-title">설문 설정</h2>
                <span class="panel-desc">Configuration</span>
            </div>

            <div class="form">

                <div class="field">
                    <div style="display: flex; gap: 16px; align-items: flex-end;">
                        <div style="flex: 2; display: flex; flex-direction: column;">
                            <label class="label" for="surveyTitle">설문명 <span class="req">*</span></label>
                            <input id="surveyTitle" class="input" type="text" placeholder="예: OT 만족도 설문" />
                        </div>
                        <div style="flex: 1; display: flex; flex-direction: column;">
                            <label class="label" for="surveyStatus">상태 <span class="req">*</span></label>
                            <select name="surveyStatus" id="surveyStatus">
                                <option value="active" selected>활성화</option>
                                <option value="inactive">비활성화</option>
                            </select>
                        </div>
                    </div>
                </div>

                <div class="field">
                <div class="label-row">
                    <label class="label">설문 유형 <span class="req">*</span></label>
                </div>
                <div class="radio-group" role="radiogroup" aria-label="설문 유형">
                    <label class="radio"><input type="radio" name="surveyType" checked /> 만족도</label>
                    <label class="radio"><input type="radio" name="surveyType" /> 평가</label>
                    <label class="radio"><input type="radio" name="surveyType" /> 기타</label>
                </div>
                </div>

                <div class="field">
                <label class="label" for="dueDate">마감일 <span class="req">*</span></label>
                <input id="dueDate" class="input" type="date" />
                </div>

                <div class="field">
                <label class="label" for="sessionLink">연계 차시</label>
                <select id="sessionLink" class="select">
                    <option value="">선택 안 함</option>
                    <option value="1">1차시 - OT</option>
                    <option value="2">2차시 - HTML/CSS</option>
                    <option value="3">3차시 - JavaScript</option>
                    <option value="4">4차시 - React 기초</option>
                </select>
                <p class="hint">연계 차시는 설문 노출 위치/타이밍에 사용됩니다.</p>
                </div>

                <div class="field">
                <label class="label">이수 반영</label>
                <div class="radio-group" role="radiogroup" aria-label="이수 반영">
                    <label class="radio"><input type="radio" name="completionReflect" checked /> 반영</label>
                    <label class="radio"><input type="radio" name="completionReflect" /> 미반영</label>
                </div>
                </div>

                <div class="field">
                <label class="label">필수 여부</label>
                <div class="radio-group" role="radiogroup" aria-label="필수 여부">
                    <label class="radio"><input type="radio" name="required" checked /> 필수</label>
                    <label class="radio"><input type="radio" name="required" /> 선택</label>
                </div>
                </div>

                <div class="field">
                <label class="label">상태</label>
                <div class="readonly">
                    <span class="badge badge-planned">예정</span>
                    <span class="muted"> (자동 설정)</span>
                </div>
                </div>

            </div>
            </section>

            <!-- RIGHT: 설문 문항 구성 -->
            <section class="panel panel-right" aria-label="설문 문항 구성">
            <div class="panel-head">
                <h2 class="panel-title">설문 문항 구성</h2>
                <span class="panel-desc">Question Builder</span>
            </div>

                <div class="questions">

                    <!-- Question Card 1 -->
                    <article class="q-card" data-qid="1">
                    <div class="q-top">
                        <div class="q-title">
                        <b>Q1.</b> 강의 내용은 만족스러웠나요?
                        </div>
                        <div class="q-actions">
                        <button class="btn btn-ghost" type="button" data-edit>수정</button>
                        <button class="btn btn-ghost danger" type="button" data-delete>삭제</button>
                        </div>
                    </div>

                    <div class="q-meta">
                        <span class="pill">유형: 척도형 (1~5)</span>
                    </div>

                    <div class="q-preview">
                        <div class="scale">
                        <span class="scale-label">미만족</span>
                        <div class="scale-nums">
                            <span class="scale-num">1</span>
                            <span class="scale-num">2</span>
                            <span class="scale-num">3</span>
                            <span class="scale-num">4</span>
                            <span class="scale-num">5</span>
                        </div>
                        <span class="scale-label">매우만족</span>
                        </div>
                    </div>
                    </article>

                    <!-- Question Card 2 -->
                    <article class="q-card" data-qid="2">
                    <div class="q-top">
                        <div class="q-title">
                        <b>Q2.</b> 개선이 필요한 점이 있다면 자유롭게 작성해주세요.
                        </div>
                        <div class="q-actions">
                        <button class="btn btn-ghost" type="button" data-edit>수정</button>
                        <button class="btn btn-ghost danger" type="button" data-delete>삭제</button>
                        </div>
                    </div>

                    <div class="q-meta">
                        <span class="pill">유형: 서술형</span>
                    </div>

                    <div class="q-preview">
                        <textarea class="textarea" rows="3" placeholder="(미리보기) 응답 입력 영역" disabled></textarea>
                    </div>
                    </article>

                    <!-- Add Question -->
                    <button class="add-question" type="button" id="openAddQuestion">
                    + 문항 추가
                    </button>
                </div>
                <!-- Footer Action Bar -->
                <footer class="actionbar" aria-label="하단 액션">
                    <button class="btn" type="button" id="cancelBtn">취소</button>
                    <div class="actionbar-right">
                        <button class="btn btn-primary" type="button" id="createBtn">설문 등록</button>
                    </div>
                </footer>
            </section>
    </main>
    
    <!-- 문항 추가 모달 (간단 버전) -->
    <div class="modal-backdrop" id="questionModal" role="dialog" aria-modal="true" aria-labelledby="questionModalTitle" hidden>
        <div class="modal">
            <header class="modal-head">
            <h3 id="questionModalTitle" class="modal-title">문항 추가</h3>
            <button class="icon-btn" type="button" aria-label="닫기" id="closeModal">✕</button>
            </header>

            <div class="modal-body">
            <div class="field">
                <label class="label" for="qText">문항 내용</label>
                <input id="qText" class="input" type="text" placeholder="예: 강사 설명은 이해하기 쉬웠나요?" />
            </div>

            <div class="field">
                <label class="label" for="qType">문항 유형</label>
                <select id="qType" class="select">
                <option value="scale">척도형 (1~5)</option>
                <option value="single">객관식(단일)</option>
                <option value="multi">객관식(복수)</option>
                <option value="text">서술형</option>
                </select>
            </div>

            <div class="field" id="choiceBox">
                <label class="label">선택지</label>
                <div class="choice-list" id="choiceList">
                <div class="choice-row">
                    <input class="input" type="text" value="매우 만족" />
                    <button class="btn btn-ghost danger" type="button" data-remove-choice>삭제</button>
                </div>
                <div class="choice-row">
                    <input class="input" type="text" value="만족" />
                    <button class="btn btn-ghost danger" type="button" data-remove-choice>삭제</button>
                </div>
                </div>
                <button class="btn btn-ghost" type="button" id="addChoice">+ 선택지 추가</button>
                <p class="hint">객관식 유형에서만 사용됩니다.</p>
            </div>
            </div>

            <footer class="modal-foot">
                <button class="btn" type="button" id="modalCancel">취소</button>
                <button class="btn btn-primary" type="button" id="modalSave">저장</button>
            </footer>
        </div>
    </div>

    <script>
            // 더미 데이터 (실제 환경에서는 DB에서 받아와야 함)
            const dummyCourse = {
                title: '풀스택 웹 개발 (3기)'
            };

            // 선택된 과정 정보 동적 렌더링
            function renderSelectedCourseInfo() {
                // 실제 환경에서는 아래 title을 DB에서 받아와야 함
                const courseTitle = dummyCourse.title;
                const container = document.getElementById('selectedCourseInfo');
                if (container) {
                    container.innerHTML = `<div style="font-size:18px; font-weight:600; color:var(--color-primary); margin-bottom:18px;">※ 선택된 과정: ${courseTitle}</div>`;
                }
            }

            document.addEventListener('DOMContentLoaded', function() {
                renderSelectedCourseInfo();
            });

            // 문항 추가 모달 기능
            (function () {
                const modal = document.getElementById('questionModal');
                const openBtn = document.getElementById('openAddQuestion');
                const closeBtn = document.getElementById('closeModal');
                const cancelBtn = document.getElementById('modalCancel');
                const saveBtn = document.getElementById('modalSave');

                const qType = document.getElementById('qType');
                const choiceBox = document.getElementById('choiceBox');
                const choiceList = document.getElementById('choiceList');
                const addChoiceBtn = document.getElementById('addChoice');

                function openModal() {
                    modal.hidden = false;
                    document.body.style.overflow = 'hidden';
                    syncChoiceBox();
                }
                function closeModal() {
                    modal.hidden = true;
                    document.body.style.overflow = '';
                }

                function syncChoiceBox() {
                const type = qType.value;
                // 객관식(단일/복수)만 선택지 편집 노출
                const show = (type === 'single' || type === 'multi');
                choiceBox.style.display = show ? 'block' : 'none';
                }

                openBtn.addEventListener('click', openModal);
                closeBtn.addEventListener('click', closeModal);
                cancelBtn.addEventListener('click', closeModal);

                // backdrop 클릭 닫기
                modal.addEventListener('click', (e) => {
                if (e.target === modal) closeModal();
                });

                // ESC 닫기
                document.addEventListener('keydown', (e) => {
                if (!modal.hidden && e.key === 'Escape') closeModal();
                });

                qType.addEventListener('change', syncChoiceBox);

                addChoiceBtn.addEventListener('click', () => {
                const row = document.createElement('div');
                row.className = 'choice-row';
                row.innerHTML = `
                    <input class="input" type="text" placeholder="선택지 내용" />
                    <button class="btn btn-ghost danger" type="button" data-remove-choice>삭제</button>
                `;
                choiceList.appendChild(row);
            });

            choiceList.addEventListener('click', (e) => {
            const btn = e.target.closest('[data-remove-choice]');
            if (!btn) return;
            const row = btn.closest('.choice-row');
            if (row) row.remove();
            });

            // 데모: 저장 버튼은 모달만 닫음 (실제 저장 로직은 TODO)
            saveBtn.addEventListener('click', () => {
            closeModal();
            // TODO: 문항을 오른쪽 목록에 추가하는 렌더링 로직 연결
            // 지금은 와이어프레임/레이아웃용
            });

            // 데모: 문항 삭제/수정 버튼 기본 동작
            document.querySelectorAll('[data-delete]').forEach(btn => {
            btn.addEventListener('click', () => {
                const card = btn.closest('.q-card');
                if (card) card.remove();
            });
            });
            document.querySelectorAll('[data-edit]').forEach(btn => {
            btn.addEventListener('click', () => {
                openModal();
                // TODO: 편집 모드로 값 채우기
            });
            });

            // 페이지 하단 버튼(데모)
            document.getElementById('cancelBtn').addEventListener('click', () => history.back());
            document.getElementById('createBtn').addEventListener('click', () => alert('설문 등록(데모)'));
        })();
    </script>
</body>
</html>