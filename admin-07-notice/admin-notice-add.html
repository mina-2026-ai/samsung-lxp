<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="../common-style.css">
    <link rel="stylesheet" href="../sidebar-style.css">
    <link rel="stylesheet" href="../btn-style.css">
    <link rel="stylesheet" href="../pagination.css">
    <script src="../sidebar-function.js" defer></script>
    <script src="../common-funtion.js" defer></script>
    <script src="../pagination.js" defer></script>
    <title>Samsung Academy LXP - 관리자</title>
    <style>
        /* admin-notice의 notice-table 스타일 참고 */
        .notice-table {
            width: 100%;
            border-collapse: collapse;
        }
        .notice-table th, .notice-table td {
            border: 1px solid #e0e0e0;
            padding: 12px 16px;
            text-align: center;
        }
        .notice-table th {
            background: #f7f7f9;
            font-weight: 700;
            color: #333;
        }
        .notice-table td {
            font-size: 15px;
            color: #333;
        }
        .notice-table td a {
            color: #007bff;
            text-decoration: none;
        }
        .notice-table td a:hover {
            text-decoration: underline;
        }

        .notice-detail-content {
            width: 100%;
            flex: 1;
            min-height: 300px;
            white-space: pre-line;
            padding: 18px;
            background: #fff;
            border: 1px solid #f0f0f0;
            border-radius: 8px;
        }
        textarea.notice-detail-content {
            resize: none; /* 사용자가 크기 조절 못하게 함 */
            overflow: auto;
        }
        
        .notice-board-section{
            display: flex;
            flex-direction: column;
            gap: 24px;
        }

        .notice-detail-footer{
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
</style>
</head>
<body>
    <!-- 상단 헤더 -->
    <header class="header">
        <h1>공지/알림 > 공지 관리 > 공지 등록</h1>
        <!-- icon -->
        <div class="icon-container">
            <div class="icon-box"><img src="/icons/bell.svg" alt="alert icon" style="width: 28px;"></div>
            <div class="icon-box" onClick="location.href='../admin-00-topmenu/admin-topmenu-user.html'"><img src="/icons/user.svg" alt="user icon" style="width: 30px;"></div>
            <div class="icon-box"><img src="/icons/setting.svg" alt="setting icon" style="width: 25px;"></div>
        </div>
    </header>

    <!-- 왼쪽 사이드바 -->
    <aside class="sidebar">
        <!-- 사이드바 메뉴 내용 -->

        <!-- logo-box -->
        <div class="logo-box">
            <img id="sidebarLogo" src="/logo-white.png" alt="logo" style="width: 130px;">
        </div>

        <!-- menu -->
        <nav class="menu">
            <ul>
                <li data-page="../admin-01-dashboard/admin-dashboard.html" onclick="handleMenuClick(this, '../admin-01-dashboard/admin-dashboard.html')">
                    <img src="../icons/01-dashboard.svg" alt="dashboard icon" style="width: 26px; margin-left:-2px; margin-right: 8px; vertical-align: middle; padding-bottom: 4px;">
                    <span class="menu-text">현황(대시보드)</span>
                </li>
                <li data-page="../admin-02-user/admin-user-trainee.html" onclick="handleMenuClick(this, '../admin-02-user/admin-user-trainee.html')" >
                    <img src="../icons/02-user.svg" alt="user icon" style="width: 28px; margin-right: 8px; vertical-align: middle; padding-bottom: 4px;">
                    <span class="menu-text">사용자 관리</span>
                    <ul>
                        <li class="submenu" onclick="event.stopPropagation(); location.href='../admin-02-user/admin-user-trainee.html'">훈련생 관리</li>
                        <li class="submenu" onclick="event.stopPropagation(); location.href='../admin-02-user/admin-user-instructor.html'">강사 관리</li>
                        <li class="submenu" onclick="event.stopPropagation(); location.href='../admin-02-user/admin-user.html'">관리자 관리</li>
                    </ul>
                </li>
                <li data-page="../admin-03-courses/admin-course-edu.html" onclick="handleMenuClick(this, '../admin-03-courses/admin-courses-edu.html')">
                    <img src="../icons/03-course.svg" alt="course icon" style="width: 25px; margin-right: 8px; vertical-align: middle; padding-bottom: 4px;">
                    <span class="menu-text">과정/운영 관리</span>
                    <ul>
                        <li class="submenu" onclick="event.stopPropagation(); location.href='../admin-03-courses/admin-courses-edu.html'">과정 관리</li>
                        <li class="submenu" onclick="event.stopPropagation(); location.href='../admin-03-courses/admin-courses-schedule.html'">일정 관리</li>
                    </ul>
                </li>
                <li data-page="../admin-04-evaluation/admin-evaluation-assignment.html" onclick="handleMenuClick(this, '../admin-04-evaluation/admin-evaluation-assignment.html')">
                    <img src="../icons/04-evaluation.svg" alt="evaluation icon" style="width: 30px; margin-left:-4px; margin-right: 7px; vertical-align: middle; padding-bottom: 4px;">
                    <span class="menu-text">평가 관리</span>
                    <ul>
                        <li class="submenu" onclick="event.stopPropagation(); location.href='../admin-04-evaluation/admin-evaluation-question-bank.html'">문제 은행</li>
                        <li class="submenu" onclick="event.stopPropagation(); location.href='../admin-04-evaluation/admin-evaluation-assignment.html'">과제 관리</li>
                        <li class="submenu" onclick="event.stopPropagation(); location.href='../admin-04-evaluation/admin-evaluation-test.html'">시험 관리</li>
                        <li class="submenu" onclick="event.stopPropagation(); location.href='../admin-04-evaluation/admin-evaluation-result.html'">채점 및 결과 관리</li>
                        <li class="submenu" onclick="event.stopPropagation(); location.href='../admin-04-evaluation/admin-evaluation-monitoring.html'">평가 모니터링</li>
                    </ul>
                </li>
                <li data-page="../admin-05-attendance/admin-attendance.html" onclick="handleMenuClick(this, '../admin-05-attendance/admin-attendance.html')">
                    <img src="../icons/05-attendance.svg" alt="attendance icon" style="width: 28px; margin-right: 8px; vertical-align: middle; padding-bottom: 4px;">
                    <span class="menu-text">출결/이수 관리</span>
                    <ul>
                        <li class="submenu" onclick="event.stopPropagation(); location.href='../admin-05-attendance/admin-attendance.html'">출결현황</li>
                        <li class="submenu" onclick="event.stopPropagation(); location.href='../admin-05-attendance/admin-attendance-graduate.html'">이수 관리</li>
                        <li class="submenu" onclick="event.stopPropagation(); location.href='../admin-05-attendance/admin-attendance-survey.html'">설문조사 관리</li>
                    </ul>
                </li>
                <li data-page="../admin-06-support/admin-support-tutoring.html" onclick="handleMenuClick(this, '../admin-06-support/admin-support-tutoring.html')">
                    <img src="../icons/06-support.svg" alt="support icon" style="width: 25px; margin-right: 8px; vertical-align: middle; padding-bottom: 4px;">
                    <span class="menu-text">학습 지원</span>
                    <ul>
                        <li class="submenu" onclick="event.stopPropagation(); location.href='../admin-06-support/admin-support-tutoring.html'">튜터링/QnA</li>
                        <li class="submenu" onclick="event.stopPropagation(); location.href='../admin-06-support/admin-support-response.html'">응답현황</li>
                        <li class="submenu" onclick="event.stopPropagation(); location.href='../admin-06-support/admin-support-chat-monitoring.html'">채팅 모니터링</li>
                    </ul>
                </li>
                <li data-page="../admin-07-notice/admin-notice.html" onclick="handleMenuClick(this, '../admin-07-notice/admin-notice.html')" class="white-icon">
                    <img src="../icons/bell.svg" alt="notice icon" style="width: 26px; margin-right: 8px; vertical-align: middle; padding-bottom: 4px;">
                    <span class="menu-text active_menu">공지/알림</span>
                    <ul>
                        <li class="submenu active_menu" onclick="event.stopPropagation(); location.href='../admin-07-notice/admin-notice.html'">공지 관리</li>
                        <li class="submenu" onclick="event.stopPropagation(); location.href='../admin-07-notice/admin-notice-alarm.html'">알림 관리</li>
                    </ul>
                </li>
            </ul>
        </nav>
                <span class="logout" onclick="location.href='../01-login/login.html'">로그아웃 

            <svg xmlns="http://www.w3.org/2000/svg" height="20px" viewBox="0 -960 960 960" width="20px" fill="CurrentColor">
                <path d="M186.67-120q-27 0-46.84-19.83Q120-159.67 120-186.67v-586.66q0-27 19.83-46.84Q159.67-840 186.67-840h292.66v66.67H186.67v586.66h292.66V-120H186.67Zm470.66-176.67-47-48 102-102H360v-66.66h351l-102-102 47-48 184 184-182.67 182.66Z"/>
            </svg>
        </span>
    </aside>

    <!-- 토글 버튼 -->
    <div class="toggle-btn" onclick="toggleSidebar()">
        ◀
    </div>

    <!-- 메인 콘텐츠 -->
    <main class="main-content">
        <!-- 훈련생 관리 -->
        <section class="main-content-inner">
            <section class="notice-board-section">
                <table class="notice-table">
                    <colgroup>
                        <col style="width: 6%;">
                        <col style="width: 8%;">
                        <col style="width: 6%;">
                        <col style="width: 12%;">
                        <col style="width: 6%;">
                        <col style="width: 14%;">
                        <col style="width: 6%;">
                        <col style="width: 14%;">
                        <col style="width: 6%;">
                        <col style="width: 10%;">
                        <col style="width: 6%;">
                        <col style="width: 6%;">
                    </colgroup>
                    <tbody>
                        <tr>
                            <th colspan="12">
                                <input id="noticeTitle" type="text" placeholder="공지 제목을 입력하세요" style="background-color: transparent; font-size: 24px;"/>
                            </th>
                        </tr>
                        <tr>
                            <th>번호</th>
                            <td id="noticeId"></td>
                            <th>작성자</th>
                            <td id="noticeAuthor"></td>
                            <th>작성일</th>
                            <td id="noticeDate"></td>
                            <th>수정일</th>
                            <td id="noticeEditDate"></td>
                            <th>수정자</th>
                            <td id="noticeEditor"></td>
                            <th>조회수</th>
                            <td id="noticeViews"></td>
                        </tr>
                        <tr>
                            <th>첨부파일</th>
                            <td colspan="12" id="noticeAttachments" style="text-align: start;"></td>
                        </tr>
                    </tbody>
                </table>

                        
                <textarea class="notice-detail-content" id="noticeContent" placeholder="공지사항 본문을 입력하세요"></textarea>

                

                <div class="notice-detail-footer">
                    <button class="btn btn-gray" style="padding: 12px 40px; font-size: 16px;" onclick="goBack()">돌아가기</button>
                    <div>
                        <button class="btn btn-save" style="padding: 12px 40px; font-size: 16px;" onclick="window.history.back()">저장하기</button>
                    </div>
                </div>
            </section>
        </section>
    </main>

    <script>
        // 바인딩 스크립트: query param 'id'가 있으면 서버에서 공지 데이터를 가져와 폼에 채웁니다.
        function getQueryParam(name) {
            const params = new URLSearchParams(window.location.search);
            return params.get(name);
        }

        function bindNoticeToForm(notice) {
            if (!notice) return;
            const titleInput = document.getElementById('noticeTitle');
            if (titleInput && titleInput.tagName === 'INPUT') titleInput.value = notice.title || '';

            const setText = (id, value) => {
                const el = document.getElementById(id);
                if (!el) return;
                el.textContent = value != null ? value : '';
            };

            setText('noticeId', notice.id ?? '');
            setText('noticeAuthor', notice.author ?? '');
            setText('noticeDate', notice.date ?? '');
            setText('noticeEditDate', notice.editDate ?? '');
            setText('noticeEditor', notice.editor ?? '');
            setText('noticeViews', notice.views ?? 0);

            // attachments
            const attDiv = document.getElementById('noticeAttachments');
            if (attDiv) {
                if (Array.isArray(notice.attachments) && notice.attachments.length) {
                    attDiv.innerHTML = notice.attachments.map(a => {
                        const name = a.name || a.filename || '첨부파일';
                        const url = a.url || a.path || '#';
                        return `<a href="${url}" download>${name}</a>`;
                    }).join(', ');
                } else {
                    attDiv.textContent = '없음';
                }
            }

            // content
            const contentEl = document.getElementById('noticeContent');
            if (contentEl) {
                if (contentEl.tagName === 'TEXTAREA' || contentEl.tagName === 'INPUT') {
                    contentEl.value = notice.content ?? '';
                } else {
                    contentEl.textContent = notice.content ?? '';
                }
            }
        }

        document.addEventListener('DOMContentLoaded', async () => {
            // 우선 전역으로 주입된 초기 데이터가 있는지 확인
            let notice = window.__initialNoticeData || null;

            const id = getQueryParam('id');
            if (!notice && id) {
                try {
                    const res = await fetch(`/api/notices/${encodeURIComponent(id)}`);
                    if (res.ok) notice = await res.json();
                } catch (err) {
                    console.warn('공지 데이터를 불러오지 못했습니다.', err);
                }
            }

            // 바인딩 실행
            bindNoticeToForm(notice);
        });
    </script>
</body>
</html>