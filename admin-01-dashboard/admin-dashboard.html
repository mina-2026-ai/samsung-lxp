<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="../common-style.css">
    <link rel="stylesheet" href="../sidebar-style.css">
    <link rel="stylesheet" href="../btn-style.css">
    
    <script src="../sidebar-function.js" defer></script>
    <script src="../common-funtion.js" defer></script>
    <title>Samsung Academy LXP - 관리자</title>
    <style>
        /* 대시보드 요약 카드 */
        .dashboard-summary {
            display: flex;
            gap: 24px;
            margin-bottom: 32px;
        }
        .dashboard-summary .card {
            flex: 1;
            background: #fff;
            border-radius: 12px;
            box-shadow: 0 2px 8px #eee;
            padding: 28px 0 20px 0;
            text-align: center;
            border: 1px solid var(--color-line-gray);
        }
        .dashboard-summary .card h3 {
            font-size: 17px;
            color: var(--color-font-gray);
            margin-bottom: 12px;
            font-weight: 500;
        }
        .dashboard-summary .card-value {
            font-size: 32px;
            font-weight: 700;
            color: var(--color-primary);
        }

        /* 대시보드 섹션 */
        .dashboard-section {
            background: #fff;
            border-radius: 8px;
            padding: 24px;
            box-shadow: 0 2px 8px #eee;
            margin-bottom: 32px;
            border: 1px solid var(--color-line-gray);
        }
        .dashboard-section h3 {
            font-size: 18px;
            color: var(--color-font-gray);
            margin-bottom: 16px;
            font-weight: 600;
        }

        /* 차시별 출석률 테이블 */
        .dashboard-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 16px;
        }
        .dashboard-table th {
            background: #f5f5f5;
            padding: 10px;
            border-bottom: 1px solid #eee;
            font-size: 15px;
            color: #666;
            font-weight: 500;
        }
        .dashboard-table td {
            padding: 10px;
            border-bottom: 1px solid #eee;
            font-size: 15px;
            color: #333;
            text-align: center;
        }
        .dashboard-table tr:last-child td {
            border-bottom: none;
        }

        /* 리스크 알림 리스트 */
        .risk-list {
            margin: 0;
            padding: 0;
            list-style: none;
        }
        .risk-list li {
            padding: 10px 0;
            border-bottom: 1px solid #eee;
            font-size: 15px;
            color: #d32f2f;
            font-weight: 500;
        }
        .risk-list li:last-child {
            border-bottom: none;
        }

        /* 차트 영역 placeholder */
        .chart-placeholder {
            height: 180px;
            background: #f5f5f5;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #999;
            font-size: 16px;
        }
        .sub-chart-placeholder {
            height: 80px;
            background: #f5f5f5;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #999;
            font-size: 16px;
        }
        .dashboard-row-flex {
            display: flex;
            gap: 0;
        }
    </style>
</head>
<body>
    <!-- 상단 헤더 -->
    <header class="header">
        <h1>현황(대시보드)</h1>
        <!-- icon -->
        <div class="icon-container">
            <div class="icon-box"><img src="/icons/bell.svg" alt="alert icon" style="width: 28px;"></div>
            <div class="icon-box" onClick="location.href='../admin-00-topmenu/admin-topmenu-user.html'"><img src="/icons/user.svg" alt="user icon" style="width: 30px;"></div>
            <div class="icon-box"><img src="/icons/setting.svg" alt="setting icon" style="width: 25px;"></div>
        </div>
    </header>

    <!-- 왼쪽 사이드바 -->
    <aside class="sidebar">
        <!-- 사이드바 메뉴 내용 -->

        <!-- logo-box -->
        <div class="logo-box">
            <img id="sidebarLogo" src="/logo-white.png" alt="logo" style="width: 130px;">
        </div>

        <!-- menu -->
        <nav class="menu">
            <ul>
                <li data-page="../admin-01-dashboard/admin-dashboard.html" onclick="handleMenuClick(this, '../admin-01-dashboard/admin-dashboard.html')">
                    <img src="../icons/01-dashboard.svg" alt="dashboard icon" style="width: 26px; margin-left:-2px; margin-right: 8px; vertical-align: middle; padding-bottom: 4px;">
                    <span class="menu-text active_menu">현황(대시보드)</span>
                </li>
                <li data-page="../admin-02-user/admin-user-trainee.html" onclick="handleMenuClick(this, '../admin-02-user/admin-user-trainee.html')">
                    <img src="../icons/02-user.svg" alt="user icon" style="width: 28px; margin-right: 8px; vertical-align: middle; padding-bottom: 4px;">
                    <span class="menu-text">사용자 관리</span>
                    <ul>
                        <li class="submenu" onclick="event.stopPropagation(); location.href='../admin-02-user/admin-user-trainee.html'">훈련생 관리</li>
                        <li class="submenu" onclick="event.stopPropagation(); location.href='../admin-02-user/admin-user-instructor.html'">강사 관리</li>
                        <li class="submenu" onclick="event.stopPropagation(); location.href='../admin-02-user/admin-user.html'">관리자 관리</li>
                    </ul>
                </li>
                <li data-page="../admin-04-evaluation/admin-evaluation-question-bank.html" onclick="handleMenuClick(this, '../admin-04-evaluation/admin-evaluation-question-bank.html')">
                    <img src="../icons/03-description.svg" alt="evaluation icon" style="width: 26px; margin-left:0px; margin-right: 7px; vertical-align: middle; padding-bottom: 4px;">
                    <span class="menu-text">콘텐츠 관리</span>
                </li>
                <li data-page="../admin-03-courses/admin-course-edu.html" onclick="handleMenuClick(this, '../admin-03-courses/admin-courses-edu.html')">
                    <img src="../icons/03-course.svg" alt="course icon" style="width: 25px; margin-right: 8px; vertical-align: middle; padding-bottom: 4px;">
                    <span class="menu-text">과정/운영 관리</span>
                    <ul>
                        <li class="submenu" onclick="event.stopPropagation(); location.href='../admin-03-courses/admin-courses-edu.html'">과정 관리</li>
                        <li class="submenu" onclick="event.stopPropagation(); location.href='../admin-03-courses/admin-courses-schedule.html'">일정 관리</li>
                    </ul>
                </li>
                <li data-page="../admin-04-evaluation/admin-evaluation-assignment.html" onclick="handleMenuClick(this, '../admin-04-evaluation/admin-evaluation-assignment.html')">
                    <img src="../icons/04-evaluation.svg" alt="evaluation icon" style="width: 30px; margin-left:-4px; margin-right: 7px; vertical-align: middle; padding-bottom: 4px;">
                    <span class="menu-text">평가 관리</span>
                    <ul>
                                                <li class="submenu" onclick="event.stopPropagation(); location.href='../admin-04-evaluation/admin-evaluation-assignment.html'">과제 배정 및 채점</li>
                        <li class="submenu" onclick="event.stopPropagation(); location.href='../admin-04-evaluation/admin-evaluation-test.html'">시험 관리</li>

                        <li class="submenu" onclick="event.stopPropagation(); location.href='../admin-04-evaluation/admin-evaluation-result.html'">시험 배정 및 채점</li>
                        <li class="submenu" onclick="event.stopPropagation(); location.href='../admin-04-evaluation/admin-evaluation-monitoring.html'">평가 모니터링</li>
                    </ul>
                </li>
                <li data-page="../admin-05-attendance/admin-attendance.html" onclick="handleMenuClick(this, '../admin-05-attendance/admin-attendance.html')">
                    <img src="../icons/05-attendance.svg" alt="attendance icon" style="width: 28px; margin-right: 8px; vertical-align: middle; padding-bottom: 4px;">
                    <span class="menu-text">출결/이수 관리</span>
                    <ul>
                        <li class="submenu" onclick="event.stopPropagation(); location.href='../admin-05-attendance/admin-attendance.html'">출결현황</li>
                        <li class="submenu" onclick="event.stopPropagation(); location.href='../admin-05-attendance/admin-attendance-graduate.html'">이수 관리</li>
                        <li class="submenu" onclick="event.stopPropagation(); location.href='../admin-05-attendance/admin-attendance-survey.html'">설문조사 관리</li>
                    </ul>
                </li>
                <li data-page="../admin-06-support/admin-support-tutoring.html" onclick="handleMenuClick(this, '../admin-06-support/admin-support-tutoring.html')">
                    <img src="../icons/06-support.svg" alt="support icon" style="width: 25px; margin-right: 8px; vertical-align: middle; padding-bottom: 4px;">
                    <span class="menu-text">학습 지원</span>
                    <ul>
                        <li class="submenu" onclick="event.stopPropagation(); location.href='../admin-06-support/admin-support-tutoring.html'">튜터링/Q&A</li>
                        <li class="submenu" onclick="event.stopPropagation(); location.href='../admin-06-support/admin-support-response.html'">응답현황</li>
                        <li class="submenu" onclick="event.stopPropagation(); location.href='../admin-06-support/admin-support-chat-monitoring.html'">채팅 모니터링</li>
                    </ul>
                </li>
                <li data-page="../admin-07-notice/admin-notice.html" onclick="handleMenuClick(this, '../admin-07-notice/admin-notice.html')" class="white-icon">
                    <img src="../icons/bell.svg" alt="notice icon" style="width: 26px; margin-right: 8px; vertical-align: middle; padding-bottom: 4px;">
                    <span class="menu-text">공지/알림</span>
                    <ul>
                        <li class="submenu" onclick="event.stopPropagation(); location.href='../admin-07-notice/admin-notice.html'">공지 관리</li>
                        <li class="submenu" onclick="event.stopPropagation(); location.href='../admin-07-notice/admin-alarm.html'">알림 관리</li>
                    </ul>
                </li>
            </ul>
        </nav>
                <span class="logout" onclick="location.href='../01-login/login.html'">로그아웃 

            <svg xmlns="http://www.w3.org/2000/svg" height="20px" viewBox="0 -960 960 960" width="20px" fill="CurrentColor">
                <path d="M186.67-120q-27 0-46.84-19.83Q120-159.67 120-186.67v-586.66q0-27 19.83-46.84Q159.67-840 186.67-840h292.66v66.67H186.67v586.66h292.66V-120H186.67Zm470.66-176.67-47-48 102-102H360v-66.66h351l-102-102 47-48 184 184-182.67 182.66Z"/>
            </svg>
        </span>
    </aside>

    <!-- 토글 버튼 -->
    <div class="toggle-btn" onclick="toggleSidebar()">
        ◀
    </div>

    <!-- 메인 콘텐츠 -->
    <main class="main-content">
    <div class="main-content-inner">
        <!-- 요약 카드 -->
        <section class="dashboard-summary" style="display: flex; gap: 24px; margin-bottom: 32px;">
            <div class="card">
                <h3>과정 수</h3>
                <div class="card-value">12</div>
            </div>
            <div class="card">
                <h3>훈련생 수</h3>
                <div class="card-value">120</div>
            </div>
            <div class="card">
                <h3>평균 출석률</h3>
                <div class="card-value">96%</div>
            </div>
            <div class="card">
                <h3>평균 이수율</h3>
                <div class="card-value">89%</div>
            </div>
        </section>

        <div class="divider"></div>

        <!-- 과정 선택 section 박스 -->
        <div style="display: flex; align-items: center; gap: 8px; margin: 8px 0 16px;">
            <span style="font-size:15px; color:#333; font-weight:500; margin: 0 4px 0 12px;">과정명</span>
            <select id="courseSelect" style="padding: 6px 16px; border-radius: 6px; border: 1px solid #ccc; font-size:15px;">
                <!-- 과정 옵션은 JS로 렌더링 -->
            </select>
            <span style="font-size:15px; color:#333; font-weight:500; margin: 0 4px 0 12px;">차시</span>
            <select id="sessionSelect" style="padding: 6px 16px; border-radius: 6px; border: 1px solid #ccc; font-size:15px; min-width: 90px;">
                <option value="all">전체 차시</option>
            </select>
            <span style="font-size:15px; color:#333; font-weight:500; margin: 0 4px 0 12px;">기간</span>
            <input type="date" style="padding: 6px 10px; border-radius: 6px; border: 1px solid #ccc; font-size:15px; width: 130px;"> 
            <span style="margin: 0 4px; color:#888;">~</span>
            <input type="date" style="padding: 6px 10px; border-radius: 6px; border: 1px solid #ccc; font-size:15px; width: 130px;">
            <input type="text" placeholder="검색어 입력" style="padding: 6px 12px; border-radius: 6px; border: 1px solid #ccc; font-size:15px; width: 140px; margin-left:8px;">
            <button class="btn btn-secondary" style="margin-left:4px;">검색</button>
        </div>

        <section style="display: flex; gap: 32px; margin-bottom: 32px;">
            <!-- 출결·이수 -->
            <div style="flex: 1; background: #fff; border-radius: 8px; padding: 24px; box-shadow: 0 2px 8px #eee;">
                <h3>출석률 차트</h3>
                <div style="height: 210px; display: flex; align-items: center; justify-content: center; background: #f5f5f5; border-radius: 8px;">
                    <canvas id="attendanceChart" width="340" height="180" style="background: transparent; width: 100%; max-width: 340px; height: 180px;"></canvas>
                </div>
                <h4 style="margin-top: 24px;">이수 위험 인원</h4>
                <ul style="margin: 0; padding: 0; list-style: none;">
                    <li>홍길동 (출석률 60%)</li>
                    <li>김민아 (출석률 65%)</li>
                    <li>이영희 (출석률 70%)</li>
                </ul>
            </div>

            <!-- 콘텐츠·설문 -->
            <div style="flex: 1; background: #fff; border-radius: 8px; padding: 24px; box-shadow: 0 2px 8px #eee;">
                <h3>콘텐츠 이수율</h3>
                <div style="height: 80px; background: #f5f5f5; border-radius: 8px; display: flex; align-items: center; justify-content: center;">[콘텐츠 이수율 차트]</div>
                <h3 style="margin-top: 24px;">설문 응답률</h3>
                <div style="height: 80px; background: #f5f5f5; border-radius: 8px; display: flex; align-items: center; justify-content: center;">[설문 응답률 차트]</div>
            </div>
        </section>

        <!-- 차시 운영 & 리스크 알림 나란히 배치 -->
        <div class="dashboard-row-flex">
            <section class="dashboard-section" style="flex:2; margin-right: 24px;">
                <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 8px; gap: 12px; flex-wrap: wrap;">
                    <h3 style="margin-bottom: 0;">차시별 출석률</h3>
                </div>
                <table class="dashboard-table">
                    <thead>
                        <tr>
                            <th>차시명</th>
                            <th>출석률</th>
                            <th>이수율</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr><td>1차시</td><td>98%</td><td>90%</td></tr>
                        <tr><td>2차시</td><td>95%</td><td>88%</td></tr>
                        <tr><td>3차시</td><td>92%</td><td>85%</td></tr>
                    </tbody>
                </table>
            </section>
            <section class="dashboard-section" style="flex:1; min-width:260px;">
                <h3>즉시 조치 필요 항목</h3>
                <ul class="risk-list">
                    <li>홍길동 - 출석률 60% (즉시 상담 필요)</li>
                    <li>김민아 - 설문 미응답 (설문 독려 필요)</li>
                    <li>이영희 - 콘텐츠 이수율 50% (학습 독려 필요)</li>
                </ul>
            </section>
        </div>
           
    </div>
    </main>

    <script>
    // --- Mock DB Data ---
    const mockCourses = [
        { id: 1, name: 'AI 엔지니어 양성과정' },
        { id: 2, name: '데이터 분석 실무과정' },
        { id: 3, name: '프론트엔드 개발자 과정' },
        { id: 4, name: '백엔드 개발자 과정' },
        { id: 5, name: '클라우드 전문가 과정' },
        { id: 6, name: 'UI/UX 디자이너 과정' },
        { id: 7, name: 'AI 서비스 기획 과정' },
        { id: 8, name: '빅데이터 분석가 과정' },
        { id: 9, name: '정보보안 전문가 과정' },
        { id: 10, name: '로봇 소프트웨어 과정' },
        { id: 11, name: '스마트팩토리 운영자 과정' }
    ];
    const mockAttendanceData = {
        1: Array.from({length: 10}, (_,i)=>({ session: `${i+1}차시`, attendance: 98-Math.floor(Math.random()*10), completion: 90-Math.floor(Math.random()*10) })),
        2: Array.from({length: 8}, (_,i)=>({ session: `${i+1}차시`, attendance: 90-Math.floor(Math.random()*10), completion: 80-Math.floor(Math.random()*10) })),
        3: Array.from({length: 12}, (_,i)=>({ session: `${i+1}차시`, attendance: 99-Math.floor(Math.random()*8), completion: 95-Math.floor(Math.random()*8) })),
        4: Array.from({length: 7}, (_,i)=>({ session: `${i+1}차시`, attendance: 85-Math.floor(Math.random()*15), completion: 75-Math.floor(Math.random()*15) })),
        5: Array.from({length: 9}, (_,i)=>({ session: `${i+1}차시`, attendance: 92-Math.floor(Math.random()*12), completion: 88-Math.floor(Math.random()*12) })),
        6: Array.from({length: 6}, (_,i)=>({ session: `${i+1}차시`, attendance: 95-Math.floor(Math.random()*10), completion: 90-Math.floor(Math.random()*10) })),
        7: Array.from({length: 11}, (_,i)=>({ session: `${i+1}차시`, attendance: 93-Math.floor(Math.random()*10), completion: 89-Math.floor(Math.random()*10) })),
        8: Array.from({length: 8}, (_,i)=>({ session: `${i+1}차시`, attendance: 97-Math.floor(Math.random()*10), completion: 92-Math.floor(Math.random()*10) })),
        9: Array.from({length: 10}, (_,i)=>({ session: `${i+1}차시`, attendance: 91-Math.floor(Math.random()*10), completion: 85-Math.floor(Math.random()*10) })),
        10: Array.from({length: 7}, (_,i)=>({ session: `${i+1}차시`, attendance: 88-Math.floor(Math.random()*12), completion: 80-Math.floor(Math.random()*12) })),
        11: Array.from({length: 9}, (_,i)=>({ session: `${i+1}차시`, attendance: 94-Math.floor(Math.random()*10), completion: 90-Math.floor(Math.random()*10) }))
    };

    // --- DOM Elements ---
    const courseSelect = document.querySelector('.main-content-inner select');
    const attendanceTableBody = document.querySelector('.dashboard-table tbody');
    // Get canvas after DOMContentLoaded
    let chartCanvas;

    // --- Populate Course Select ---
    function populateCourseSelect() {
        if (!courseSelect) return;
        courseSelect.innerHTML = '';
        const allOpt = document.createElement('option');
        allOpt.value = 'all';
        allOpt.textContent = '전체 과정';
        courseSelect.appendChild(allOpt);
        mockCourses.forEach(c => {
            const opt = document.createElement('option');
            opt.value = c.id;
            opt.textContent = c.name;
            courseSelect.appendChild(opt);
        });
    }

    // --- Render Attendance Table ---
    function renderAttendanceTable(courseId) {
        if (!attendanceTableBody) return;
        attendanceTableBody.innerHTML = '';
        let data = [];
        if (courseId === 'all') {
            // 합쳐서 보여주기 (각 과정별로 구분)
            Object.entries(mockAttendanceData).forEach(([cid, arr]) => {
                const courseName = (mockCourses.find(c => c.id == cid) || {}).name || '';
                arr.forEach(row => {
                    const tr = document.createElement('tr');
                    tr.innerHTML = `<td>${courseName} - ${row.session}</td><td>${row.attendance}%</td><td>${row.completion}%</td>`;
                    attendanceTableBody.appendChild(tr);
                });
            });
        } else {
            data = mockAttendanceData[courseId] || [];
            data.forEach(row => {
                const tr = document.createElement('tr');
                tr.innerHTML = `<td>${row.session}</td><td>${row.attendance}%</td><td>${row.completion}%</td>`;
                attendanceTableBody.appendChild(tr);
            });
        }
    }

    // --- Draw Attendance Chart ---
    function drawAttendanceChart(courseId) {
        if (!chartCanvas) return;
        const ctx = chartCanvas.getContext('2d');
        ctx.clearRect(0, 0, chartCanvas.width, chartCanvas.height);
        let data = [];
        if (courseId === 'all') {
            // 모든 과정의 차시를 한 배열로 합침 (최대 10개만 표시)
            data = Object.entries(mockAttendanceData).flatMap(([cid, arr]) => {
                const courseName = (mockCourses.find(c => c.id == cid) || {}).name || '';
                return arr.map(row => ({...row, session: courseName + ' - ' + row.session}));
            }).slice(0, 10); // 너무 많으면 10개만
        } else {
            data = mockAttendanceData[courseId] || [];
        }
        // Dynamic bar chart for more data
        const maxVal = 100;
        const chartHeight = 150;
        const chartBottom = 180;
        const barWidth = 18;
        const gap = 28; // 더 넓은 간격
        const startX = 50;
        data.forEach((row, i) => {
            const x = startX + i * (barWidth * 2 + gap);
            // Attendance bar
            ctx.fillStyle = '#0069FF';
            ctx.fillRect(x, chartBottom - (row.attendance / maxVal) * chartHeight, barWidth, (row.attendance / maxVal) * chartHeight);
            // Completion bar
            ctx.fillStyle = '#00B894';
            ctx.fillRect(x + barWidth, chartBottom - (row.completion / maxVal) * chartHeight, barWidth, (row.completion / maxVal) * chartHeight);
            // (차트 안에 텍스트 제거, X축 라벨만 유지)
        });
        // Y axis
        ctx.strokeStyle = '#bbb';
        ctx.beginPath();
        ctx.moveTo(30, 30);
        ctx.lineTo(30, chartBottom);
        ctx.stroke();
        // X axis
        ctx.beginPath();
        ctx.moveTo(30, chartBottom);
        ctx.lineTo(320, chartBottom);
        ctx.stroke();
        // Y축 레이블
        ctx.save();
        ctx.translate(10, chartBottom - chartHeight/2);
        ctx.rotate(-Math.PI/2);
        ctx.font = '13px sans-serif';
        ctx.fillStyle = '#333';
        ctx.textAlign = 'center';
        ctx.fillText('비율 (%)', 0, 0);
        ctx.restore();
        // X축 레이블
        ctx.font = '13px sans-serif';
        ctx.fillStyle = '#333';
        ctx.textAlign = 'center';
        ctx.fillText('차시', 170, 210);
        // Legend
        ctx.fillStyle = '#0069FF';
        ctx.fillRect(260, 20, 12, 12);
        ctx.fillStyle = '#333';
        ctx.font = '12px sans-serif';
        ctx.fillText('출석률', 290, 30);
        ctx.fillStyle = '#00B894';
        ctx.fillRect(260, 38, 12, 12);
        ctx.fillStyle = '#333';
        ctx.fillText('이수율', 290, 48);
    }

    // --- Event Bindings ---
    if (courseSelect) {
        courseSelect.addEventListener('change', function() {
            const courseId = this.value;
            renderAttendanceTable(courseId);
            drawAttendanceChart(courseId);
        });
    }

    // --- Initial Render ---
    window.addEventListener('DOMContentLoaded', () => {
        populateCourseSelect();
        const initialCourseId = courseSelect ? courseSelect.value : 1;
        renderAttendanceTable(initialCourseId);
        chartCanvas = document.getElementById('attendanceChart');
        drawAttendanceChart(initialCourseId);
    });
    </script>
    <canvas id="attendanceChart" width="340" height="210" style="background: #f5f5f5; border-radius: 8px; width: 100%; max-width: 340px; height: 210px;"></canvas>
</body>
</html>